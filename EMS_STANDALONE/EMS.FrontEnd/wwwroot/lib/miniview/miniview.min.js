(function(n){n.fn.miniview=function(t){function b(n){p=!0;r.css("cursor","move");var t=r.position();l=Math.round(t.left+u+h/2);a=Math.round(t.top+f+c/2);k(n);n.type=="touchstart"?(v="touchmove",y="touchend"):(v="mousemove",y="mouseup");r.on(v,k);r.on(y,nt)}function k(n){var e,t,r;if(p){if(n.preventDefault(),n.type.match(/touch/)){if(n.touches.length>1)return;e=n.touches[0]}else e=n;t=e.clientX-l;r=e.clientY-a;u+t<0&&(t=-u);f+r<0&&(r=-f);u+h+4+t>o&&(t=o-4-u-h);f+c+4+r>s&&(r=s-4-f-c);l+=t;a+=r;u+=t;f+=r;var w=o/i[0].scrollWidth,b=s/i[0].scrollHeight,v=u/w,y=f/b;navigator.userAgent.match(/webkit/i)?(i[0].scrollLeft=Math.round(v),i[0].scrollTop=Math.round(y)):(i[0].scrollLeft=Math.round(v),i[0].scrollTop=Math.round(y));d()}}function nt(){p=!1;r.css("cursor","default")}function w(){var n=[i.width(),i.height()],t=[i.scrollLeft(),i.scrollTop()],r=o/i[0].scrollWidth,e=s/i[0].scrollHeight,l=n[0]*r-4,a=n[1]*e-4,v=t[0]*r,y=t[1]*e;h=Math.round(l);c=Math.round(a);u=Math.round(v);f=Math.round(y);d()}function d(){e.css("width",h+"px");e.css("height",c+"px");e.css("left",u+"px");e.css("top",f+"px")}function g(){return r.find(".mini").remove(),t.each(function(){var t=n("<div><\/div>").addClass("mini");r.append(t);var u=o/i[0].scrollWidth,f=s/i[0].scrollHeight,e=n(this).width()*u,h=n(this).height()*f,c=(n(this).position().left+i.scrollLeft())*u,l=(n(this).position().top+i.scrollTop())*f;t.css("width",Math.round(e)+"px");t.css("height",Math.round(h)+"px");t.css("left",Math.round(c)+"px");t.css("top",Math.round(l)+"px")}),this}var i=this,r,o,s,l,a,u,f,h,c,v,y,p=!1,e;r=n("#miniview");o=r.width()-2;s=r.height()-2;e="";e=n("<div><\/div>").addClass("port").css("z-index",1);r.append(e);w();i.on("resize",w);i.on("drag",g);i.on("scroll",w);r.on("mousedown",b);r.on("touchstart",b);r.on("touchmove",function(n){n.preventDefault()});g()}})(jQuery);