var objUpdateLogActivityJS;$(document).ready(function(){objUpdateLogActivityJS={Initialize:function(){$("#divLogActivityBodyModal .modal-header").mousedown(handle_mousedown);var n=this;$("#divLogActivityModal label[for='ddlType'] span,                     #divLogActivityModal label[for='ddlTitle'] span,                     #divLogActivityModal label[for='ddlStatus'] span,                     #divLogActivityModal label[for='txtTitle'] span,                     #divLogActivityModal label[for='dpDueDate'] span").removeClass("reqField");$("#divLogActivityModal label[for='ddlType'] span,                    #divLogActivityModal label[for='ddlTitle'] span,                    #divLogActivityModal label[for='ddlStatus'] span,                    #divLogActivityModal label[for='txtTitle'] span,                    #divLogActivityModal label[for='dpDueDate'] span").addClass("unreqField");$("#divLogActivityModal #ddlType, #divLogActivityModal #ddlStatus, #divLogActivityModal #ddlAssignedOrgGroup,                 #divLogActivityModal #cbIsPass, #divLogActivityModal #cbIsVisible, #divLogActivityModal #txtAssignedUser,                 #divLogActivityModal #cbIsAssignToSelf, #divLogActivityModal #txtAssignedOrgGroup").attr("disabled",!0);$("#lblEmployeeCurrentStatus").text()=="DONE"||$("#lblEmployeeCurrentStatus").text()=="CANCELLED"?$("#divLogActivityModal #btnEditActivity").hide():$("#divLogActivityModal #btnEditActivity").show();n.ElementBinding();n.GetAttachmentTypeDropDownOptions();EmployeelogActivityDeletedAttachments=[];objUpdateLogActivityJS.LoadLogActivityStatusHistoryJQGrid({ID:$("#hdnEmployeeLogActivityID").val()});$("#divAssignUser").show();$("#divLogActivityModal #divAssignUser .form-control").attr("readonly",!1);$("#divIsWithPassFail").show();$("#divIsVisible").show();$("#lblHeaderType").text($("#ddlType option:selected").text());n.GetComment();n.GetAttachment();objEMSCommonJS.ChangeTab($(".tablinks:nth-child(1)"),"tabHistory","#divLogActivityModal")},ElementBinding:function(){var n=this;$("#divLogActivityModal #btnSaveActivity").click(function(){objEMSCommonJS.ValidateBlankFields("#frmLogActivity","#divLogActivityErrorMessage")&&ModalConfirmation(MODAL_HEADER,MSG_CONFIRM,"objEMSCommonJS.PostAjax(true                         , EmployeeUpdateLogActivityPostURL                         , objUpdateLogActivityJS.GetFormData()                         , '#divLogActivityErrorMessage'                         , '#btnSaveActivity'                         , objUpdateLogActivityJS.UpdateSuccessFunction);","function")});$("#dpDueDate").datetimepicker({useCurrent:!1,format:"MM/DD/YYYY"});$("#divLogActivityModal #btnEditActivity").click(function(){$("#divLogActivityModal .form-control").attr("readonly",!1);$("#divLogActivityModal #ddlType, #divLogActivityModal #ddlStatus, #divLogActivityModal #ddlAssignedOrgGroup,                     #divLogActivityModal #cbIsPass, #divLogActivityModal #cbIsVisible,                     #divLogActivityModal #cbIsAssignToSelf, #divLogActivityModal #txtAssignedOrgGroup").attr("disabled",!1);$("#divLogActivityModal label[for='ddlType'] span,                    #divLogActivityModal label[for='ddlTitle'] span,                    #divLogActivityModal label[for='txtTitle'] span,                    #divLogActivityModal label[for='dpDueDate'] span").addClass("reqField");$("#divLogActivityModal label[for='ddlType'] span,                    #divLogActivityModal label[for='ddlTitle'] span,                    #divLogActivityModal label[for='txtTitle'] span,                    #divLogActivityModal label[for='dpDueDate'] span").removeClass("unreqField");$("#divLogActivityModal #btnEditActivity").hide();$("#divLogActivityModal #btnSaveActivity").show();$("#divLogActivityModal #btnBackActivity").show();$("#cbIsAssignToSelf").is(":checked")?$("#txtAssignedUser").prop("disabled",!0):$("#txtAssignedUser").prop("disabled",!1)});$("#divLogActivityModal #btnBackActivity").click(function(){$("#divLogActivityModal #txtTitle, #divLogActivityModal #txtDescription, #divLogActivityModal #dpDueDate,                     #divLogActivityModal #txtRemarks").attr("readonly",!0);$("#divLogActivityModal #ddlType, #divLogActivityModal #ddlStatus, #divLogActivityModal #ddlAssignedOrgGroup,                     #divLogActivityModal #cbIsPass, #divLogActivityModal #cbIsVisible, #divLogActivityModal #txtAssignedUser,                     #divLogActivityModal #cbIsAssignToSelf, #divLogActivityModal #txtAssignedOrgGroup").attr("disabled",!0);$("#divLogActivityModal label[for='ddlType'] span,                    #divLogActivityModal label[for='ddlTitle'] span,                    #divLogActivityModal label[for='txtTitle'] span,                    #divLogActivityModal label[for='dpDueDate'] span").removeClass("reqField");$("#divLogActivityModal label[for='ddlType'] span,                    #divLogActivityModal label[for='ddlTitle'] span,                    #divLogActivityModal label[for='txtTitle'] span,                    #divLogActivityModal label[for='dpDueDate'] span").addClass("unreqField");$("#divLogActivityModal #btnEditActivity").show();$("#divLogActivityModal #btnSaveActivity").hide();$("#divLogActivityModal #btnBackActivity").hide()});$("#divLogActivityModal #btnSaveComment").click(function(){$("#divLogActivityModal #txtAreaComments").val()!=""?objEMSCommonJS.PostAjax(!0,EmployeeSaveCommentsURL,objUpdateLogActivityJS.GetCommentSectionFormData(),"#divLogActivityErrorMessage","#btnSaveComment",objUpdateLogActivityJS.GetComment,null,!0):$("#divLogActivityModal #txtAreaComments").focus()});objEMSCommonJS.BindAutoComplete("divLogActivityModal #txtAssignedUser",ReferredByAutoComplete,20,"divLogActivityModal #hdnAssignedUserID","ID","Description");$("#divLogActivityModal #btnSaveAttachmentActivity").click(function(){var n=function(){return $(".LogActivity_Attachment_Type").length==0?($("#frmLogActivity #divLogActivityErrorMessage").html('<label class="errMessage"><li>Please click plus icon to add attachment<\/li><\/label><br />'),!1):!0};objEMSCommonJS.ValidateBlankFields("#frmLogActivity #DivLogActivityUploadAttachmentDynamicFields","#divLogActivityErrorMessage",n)&&ModalConfirmation(MODAL_HEADER,MSG_CONFIRM,"objEMSCommonJS.PostAjax(true                         , EmployeeSaveAttachmentURL                         , objUpdateLogActivityJS.GetAttachmentSectionFormData()                         , '#divLogActivityErrorMessage'                         , '#btnSaveAttachmentActivity'                         , objUpdateLogActivityJS.AttachmentUpdateSuccessFunction);","function")});$("#divLogActivityModal #btnLogActivityAddAttachmentFields").click(function(){var i=$("#DivLogActivityUploadAttachmentDynamicFields .required-field"),t=!0;i.each(function(){if($(this).val()=="")return $(this).focus(),t=!1,!1});t&&n.AddAttachmentDynamicFields()});$("#divLogActivityModal #LogActivitylnkType").click(function(){var t=function(){$("#divReferenceModal .close").unbind();$("#divReferenceModal .close").click(function(){var t=$(".LogActivityAttachmentDynamicFields:last").prop("id"),i=parseInt(t==undefined?0:t.replace("LogActivityAttachmentDynamicFields_",""));n.GetAttachmentTypeDropDownOptions();objEMSCommonJS.PopulateDropDown("#DivLogActivityDownloadAttachmentDynamicFields #ddlType_"+i,EmployeeLogActivityAttachmentTypeDropDownOptions)})};LoadPartialSuccessFunction(AddReferenceURL,"divReferenceBodyModal",t);$("#divReferenceModal #hdnReferenceCode").val("ATTACHMENT_TYPE");$("#divReferenceModal #hdnReferenceField").val("lnkType");$("#divReferenceModal").modal("show")});$("#cbIsAssignToSelf").on("click",function(){$(this).is(":checked")?$("#txtAssignedUser").prop("disabled",!0):$("#txtAssignedUser").prop("disabled",!1);$("#txtAssignedUser").val("");$("#hdnAssignedUserID").val("")});objEMSCommonJS.BindAutoComplete("txtAssignedOrgGroup",OrgGroupAutoCompleteURL,20,"hdnAssignedOrgGroup","ID","Description")},GetFormData:function(){var n=new FormData($("#frmLogActivity").get(0));return n.append("EmployeeLogActivityForm.EmployeeID",$("#divEmployeeModal #hdnID").val()),n},UpdateSuccessFunction:function(){$("#divLogActivityModal").modal("hide");objLogActivityJS.LoadLogActivityJQGrid({EmployeeID:$("#divEmployeeModal #hdnID").val()})},AttachmentUpdateSuccessFunction:function(){LoadPartial(EmployeeUpdateLogActivityURL+"?EmployeeLogActivityID="+$("#hdnEmployeeLogActivityID").val(),"divLogActivityBodyModal")},LoadLogActivityStatusHistoryJQGrid:function(n){var t=this;Loading(!0);$("#tblLogActivityStatusHistoryList").jqGrid("GridUnload");$("#tblLogActivityStatusHistoryList").jqGrid("GridDestroy");$("#tblLogActivityStatusHistoryList").jqGrid({url:EmployeeGetLogActivityStatusHistoryURL,postData:n,sortname:"",sortorder:"",selrow:"",pageNumber:1,rowNum:1e4,datatype:"json",mtype:"GET",colNames:["Status","Timestamp","User","Remarks"],colModel:[{name:"Status",index:"Status",align:"left",sortable:!1},{name:"Timestamp",index:"Timestamp",align:"left",sortable:!1},{name:"User",index:"User",align:"left",sortable:!1},{name:"Remarks",index:"Remarks",align:"left",sortable:!1},],rowList:SetRowList(),loadonce:!1,viewrecords:!0,jsonReader:{root:"rows",page:"page",total:"total",records:"records",repeatitems:!1},emptyrecords:"No records to display",multiselect:!1,rowNumbers:!0,width:"100%",height:"100%",sortable:!0,loadComplete:function(n){if(Loading(!1),n.IsSuccess!=undefined&&(n.IsSuccess||($("#divErrorMessage").html(""),ModalAlert(MODAL_HEADER,n.Result))),n.rows!=null){if(n.rows.length>0)for(var t=0;t<n.rows.length;t++);AutoSizeColumnJQGrid("tblLogActivityStatusHistoryList",n);$("#tblLogActivityStatusHistoryList_subgrid").width(20);$(".jqgfirstrow td:first").width(20)}},loadError:function(n){ModalAlert(MODAL_HEADER,n.responseText);Loading(!1)}})},UpdateLink:function(n,t,i){return"<a href=\"\" class='activity-id-link' onclick=\"return LoadPartial('"+EmployeeViewURL+"?ID="+i.ID+"', 'divEmployeeBodyModal');\">Update<\/a>"},AddPreloadedSuccessFunction:function(){objUpdateLogActivityJS.LoadLogActivityJQGrid({EmployeeID:$("#divEmployeeModal #hdnID").val()})},GetComment:function(){var t={ID:$("#divLogActivityModal #hdnEmployeeLogActivityID").val()},n;$("#divLogActivityModal #txtAreaComments").val("");n=function(n){n.IsSuccess==!0&&($("#divLogActivityModal #divCommentsContainer").html(""),n.Result.length>0?($("#divLogActivityModal #divCommentsContainer").append("<span class='comment-header'>-- Start --<\/span>"),$(n.Result).each(function(t,i){$("#divLogActivityModal #divCommentsContainer").append("<span class='comment-details'>"+i.Timestamp+" "+i.Sender+": <\/span><span class='comment'> "+i.Comments+"<\/span><br>");n.Result.length<=t+1&&setTimeout(function(){$("#divLogActivityModal #divCommentsContainer").scrollTop($("#divLogActivityModal #divCommentsContainer")[0].scrollHeight)},300)})):$("#divLogActivityModal #divCommentsContainer").append("<span class='comment-header'>-- No comments found. --<\/span>"),$("#divLogActivityModal #txtAreaComments").attr("readonly",!1),$("#divLogActivityModal #txtAreaComments").prop("disabled",!1))};objEMSCommonJS.GetAjax(EmployeeGetCommentsURL,t,"",n)},GetAttachment:function(){var i=this,n={ID:$("#hdnEmployeeLogActivityID").val()},t=function(n){var i,t;$("#DivLogActivityDownloadAttachmentDynamicFields").html("");i=function(n,t){var r=$(".LogActivityAttachmentDynamicFields:last").prop("id"),i=parseInt(r==undefined?0:r.replace("LogActivityAttachmentDynamicFields_",""))+1;$("#DivLogActivityDownloadAttachmentDynamicFields").append('<div class="form-group form-fields LogActivityAttachmentDynamicFields" id="LogActivityAttachmentDynamicFields_'+i+'">    <div class="col-md-1-5 no-padding">        <select id="ddlType_'+i+'" class= "form-control required-field LogActivity_Attachment_Type" title="Attachment Type"><\/select >    <\/div>    <div class="col-md-2-5 no-padding">        <textarea rows="3" cols="10" wrap="hard" id="txtRemarks_'+i+'" maxlength="255" class="form-control LogActivity_Attachment_Remarks" title="Remarks"><\/textarea>    <\/div>    <div class="col-md-3-5 no-padding">        <label class="control-label block-label LogActivity_Attachment_File"> <span class="unreqField">* <\/span>'+n.SourceFile+'<\/label>        <input type="hidden" id="txtServerFile_ '+i+'" value="'+n.ServerFile+'" class="form-control LogActivity_Attachment_ServerFile">        <input type="hidden" id="txtSourceFile_ '+i+'" value="'+n.SourceFile+'" class="form-control LogActivity_Attachment_SourceFile">    <\/div>    <div class="col-md-3-5 no-padding">        <label class="control-label block-label"> <span class="unreqField">* <\/span>'+n.UploadedBy+"<br> Timestamp: "+n.Timestamp+'<\/label>    <\/div>    <div class="col-md-0-5 no-padding">        <span class="btn-glyph-dynamic glyphicon glyphicon-trash" onclick="ModalConfirmation(MODAL_HEADER, MSG_CONFIRM_DELETE_SINGLE, &quot;objEmployeeListJS.RemoveDynamicFields(\'#LogActivityAttachmentDynamicFields_'+i+"',objUpdateLogActivityJS.DeleteAttachmentFunction(&#39;"+n.ServerFile+'&#39;))&quot;, &quot;function&quot;);"><\/span>    <\/div>     <div class="col-md-0-5 no-padding">         <span class="btn-glyph-dynamic glyphicon glyphicon-download-alt" onclick="objEMSCommonJS.DownloadAttachment(CheckFileIfExistsURL, \'WorkflowService_LogActivity_Attachment_Path\',\''+n.ServerFile+"', '"+n.SourceFile+"')\"><\/span>     <\/div><\/div>");objEMSCommonJS.PopulateDropDown("#DivLogActivityDownloadAttachmentDynamicFields #ddlType_"+i,EmployeeLogActivityAttachmentTypeDropDownOptions);$("#DivLogActivityDownloadAttachmentDynamicFields #ddlType_"+t).val(n.AttachmentType);$("#DivLogActivityDownloadAttachmentDynamicFields #txtRemarks_"+t).val(n.Remarks)};n.IsSuccess==!0&&($("#divAttachmentContainer").html(""),n.Result.length>0&&(t=1,$(n.Result).each(function(n,r){i(r,t);t++})))};objEMSCommonJS.GetAjax(EmployeeGetAttachmentURL,n,"",t)},GetCommentSectionFormData:function(){var n=new FormData($("#frmLogActivity").get(0));return n.append("CommentsForm.EmployeeLogActivityID",$("#hdnEmployeeLogActivityID").val()),n.append("CommentsForm.Comments",$("#txtAreaComments").val()),n},GetAttachmentSectionFormData:function(){$(".LogActivity_Attachment_Type").each(function(n){$(this).prop("name","AttachmentForm.AddAttachmentForm["+n+"].AttachmentType")});$(".LogActivity_Attachment_Remarks").each(function(n){$(this).prop("name","AttachmentForm.AddAttachmentForm["+n+"].Remarks")});$(".LogActivity_Attachment_ServerFile").each(function(n){$(this).prop("name","AttachmentForm.AddAttachmentForm["+n+"].ServerFile")});$(".LogActivity_Attachment_SourceFile").each(function(n){$(this).prop("name","AttachmentForm.AddAttachmentForm["+n+"].SourceFile")});$(".LogActivity_Attachment_File").each(function(n){$(this).prop("name","AttachmentForm.AddAttachmentForm["+n+"].File")});var n=new FormData($("#frmLogActivity").get(0));return n.append("AttachmentForm.EmployeeLogActivityID",$("#hdnEmployeeLogActivityID").val()),$(EmployeelogActivityDeletedAttachments).each(function(t,i){n.append("AttachmentForm.DeleteAttachmentForm["+t+"].ServerFile",i.value)}),n},GetAttachmentTypeDropDownOptions:function(){var t=this,n;EmployeeLogActivityAttachmentTypeDropDownOptions=[];n=function(n){$(n.Result).each(function(n,t){EmployeeLogActivityAttachmentTypeDropDownOptions.push({Value:t.Value,Text:t.Description})})};objEMSCommonJS.GetAjax(AttachmentTypeDropDown,{},"",n)},RemoveDynamicFields:function(n,t){$(n).remove();ModalAlert(MODAL_HEADER,MSG_SUCCESS_DELETE_REC);t!=null&&t()},DeleteAttachmentFunction:function(n){EmployeelogActivityDeletedAttachments.push(n)},AddAttachmentDynamicFields:function(){var i=this,t=$(".LogActivityAttachmentDynamicFields:last").prop("id"),n=parseInt(t==undefined?0:t.replace("LogActivityAttachmentDynamicFields_",""))+1;$("#DivLogActivityUploadAttachmentDynamicFields").append('<div class="form-group form-fields LogActivityAttachmentDynamicFields" id="LogActivityAttachmentDynamicFields_'+n+'">    <div class="col-md-1-5 no-padding">        <select id="ddlType_'+n+'" class= "form-control required-field LogActivity_Attachment_Type" title="Attachment Type"><\/select >    <\/div>    <div class="col-md-2-5 no-padding">        <textarea rows="3" cols="10" wrap="hard"  id="txtRemarks_'+n+'" maxlength="255" class="form-control LogActivity_Attachment_Remarks" title="Remarks"><\/textarea>    <\/div>    <div class="col-md-3-5 no-padding">        <input type="file" id="fileAttachment_'+n+'" class="form-control required-field LogActivity_Attachment_File" title="Attachment" accept=".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document">    <\/div>    <div class="col-md-3-5 no-padding">    <\/div>    <div class="col-md-0-5 no-padding">        <span class="btn-glyph-dynamic glyphicon glyphicon-trash" onclick="ModalConfirmation(MODAL_HEADER, MSG_CONFIRM_DELETE_SINGLE, &quot;objEmployeeListJS.RemoveDynamicFields(\'#LogActivityAttachmentDynamicFields_'+n+"')&quot;, &quot;function&quot;);\"><\/span>    <\/div><\/div>");objEMSCommonJS.PopulateDropDown("#ddlType_"+n,EmployeeLogActivityAttachmentTypeDropDownOptions)}};objUpdateLogActivityJS.Initialize()});