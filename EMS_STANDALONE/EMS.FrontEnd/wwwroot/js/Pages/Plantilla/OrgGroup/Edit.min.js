var objOrgGroupEditJS,OrgGroupListBoxOptions=[],PositionLevelDropDownOptions=[],PositionPlannedOld=[],PositionPlannedNew=[],CheckFileIfExistsURL=window.location.pathname+"?handler=CheckFileIfExists",DownloadFileURL=window.location.pathname+"?handler=DownloadFile";$(document).ready(function(){objOrgGroupEditJS={ID:$("#hdnID").val(),Initialize:function(){$("#divOrgGroupBodyModal .modal-header").mousedown(handle_mousedown);var n=this;n.ElementBinding();$("#divOrgGroupModal .form-control").attr("readonly",!1);$("#divOrgGroupModal #btnEdit").hide();$("#divOrgGroupModal #btnSave, #divOrgGroupModal #btnBack").show();n.GetOrgGroupListBoxOptions();n.LoadChildrenOrgGroup();n.LoadOrgGroupPosition();n.LoadOrgGroupNPRF();$("#txtParentOrgGroup").change();objEMSCommonJS.ChangeTab($(".tablinks:nth-child(1)"),"tabOrgGroupPosition");$("#divOrgGroupTags").children().length==0&&$(".tablinks:nth-child(3)").hide();parseInt($("#hdnOrgGroupTagCount").val())==0&&$("#ddlOrgType").change();n.AddNPRFDynamicFields()},DeleteSuccessFunction:function(){$("#divOrgGroupTableList #btnSearch").click();$("#divOrgGroupModal").modal("hide")},EditSuccessFunction:function(){$("#divOrgGroupTableList #btnSearch").click();$("#btnBack").click()},ElementBinding:function(){var n=this,t;Code($("#txtCode"));NumberOnly($("#txtServiceBayCount"));PreventSpace($("#txtCode"));$("#txtCode").bind("copy paste cut",function(n){n.preventDefault()});$("#ddlOrgType").change(function(){$("#divOrgGroupTags").html("");$(this).val()=="TOP"?($("#reqParentGroup").hide(),$("#txtParentOrgGroup").removeClass("required-field")):($("#reqParentGroup").show(),$("#txtParentOrgGroup").addClass("required-field"));var n=function(n){n.Result.length!=0?($(n.Result).each(function(n,t){$("#divOrgGroupTags").append('<div class="form-group form-fields">                                   <div class="col-md-2-5 col-label">                                       <label class="control-label block-label" for="ddl'+t.Value+'"> <span class="reqField">* <\/span>'+t.Description+'<\/label>                                   <\/div>                                   <div class="col-md-4">                                       <input type="hidden" id="hdnCode_'+t.Value+'" value="'+t.Value+'" class="OrgGroupTagList_Code"/>                                       <select id="ddl'+t.Value+'" title="'+t.Description+'" class="form-control required-field OrgGroupTagList_Value">                                           <option value="">- Select an item -<\/option>                                       <\/select>                                   <\/div>                                <\/div>');$(t.DropDownOptions).each(function(n,i){$("#ddl"+t.Value).append('<option value="'+i.Value+'">'+i.Description+"<\/option>")})}),$(".tablinks:nth-child(3)").show()):$(".tablinks:nth-child(3)").hide()};objEMSCommonJS.GetAjax(GetOrgGroupTagsByOrgGroupTypeURL+"ORG_"+$(this).val()+"_TAGS",{},"",n)});t=function(n){if(n!=""){var t=function(n){var r=n.Result.length,t=$("#txtCode").val(),i=$("#txtDescription").val();$("#divHierarchyUpward").html("");$(n.Result).each(function(n,t){$("#divHierarchyUpward").append(t.Code+" - "+t.Description+" > ")});t!=""&&$("#divHierarchyUpward").append(t+" - "+i)};objEMSCommonJS.GetAjax(OrgTypeHierarchyUpwardURL+"&ID="+n,{},"",t,null,!1)}};objEMSCommonJS.BindAutoComplete("divOrgGroupModal #txtParentOrgGroup",ParentOrgGroupAutoCompleteURL,20,"divOrgGroupModal #hdnParentOrgID","ID","Description",t);$("#txtParentOrgGroup").change(function(){if($("#txtParentOrgGroup").val()=="")$("#divHierarchyUpward").html("");else{var n=function(n){var r=n.Result.length,t=$("#txtCode").val(),i=$("#txtDescription").val();$("#divHierarchyUpward").html("");$(n.Result).each(function(n,t){$("#divHierarchyUpward").append(t.Code+" - "+t.Description+" > ")});t!=""&&$("#divHierarchyUpward").append(t+" - "+i)};objEMSCommonJS.GetAjax(OrgTypeHierarchyUpwardURL+"&ID="+$("#hdnParentOrgID").val(),{},"",n,null,!0)}});$("#btnMoveToListTwo").click(function(){ListBoxMove("ddlListOneOrgGroup","ddlListTwoOrgGroup",!1,!0)});$("#btnMoveToListOne").click(function(){ListBoxMove("ddlListTwoOrgGroup","ddlListOneOrgGroup",!1,!0)});$("#btnMoveToListTwoAll").click(function(){ListBoxMove("ddlListOneOrgGroup","ddlListTwoOrgGroup",!0,!0)});$("#btnMoveToListOneAll").click(function(){ListBoxMove("ddlListTwoOrgGroup","ddlListOneOrgGroup",!0,!0)});$("#txtSearchBoxOne").on("change keyup keydown",function(){ListBoxSearch("ddlListOneOrgGroup",$(this).val(),!1)});$("#txtSearchBoxTwo").on("change keyup keydown",function(){ListBoxSearch("ddlListTwoOrgGroup",$(this).val(),!1)});$("#btnAddChildrenManPowerFields").click(function(){$(".PositionTextDynamicFields").addClass("required-field");$(".PlannedDynamicFields").addClass("required-field");$(".ActiveDynamicFields").addClass("required-field");$(".InactiveDynamicFields").addClass("required-field");var i=$("#DivChildrenManPowerDynamicFields .required-field"),t=!0;i.each(function(){if($(this).val()=="")return $(this).focus(),t=!1,!1});t&&n.AddChildrenManPowerDynamicFields(0,0)});$("#btnAddNPRFFields").click(function(){$(".NPRFNumberDynamicFields").addClass("required-field");$(".DateApprovedDynamicFields").addClass("required-field");var i=$("#DivNPRFDynamicFields .required-field"),t=!0;i.each(function(){if($(this).val()=="")return $(this).focus(),t=!1,!1});t&&n.AddNPRFDynamicFields(0,0)});$("#btnDelete").click(function(){ModalConfirmation(MODAL_HEADER,MSG_CONFIRM_DELETE_SINGLE,"objEMSCommonJS.PostAjax(false                     , OrgGroupDeleteURL + '?ID=' + objOrgGroupEditJS.ID                    , {}                     , '#divOrgGroupErrorMessage'                     , '#btnDelete'                     , objOrgGroupEditJS.DeleteSuccessFunction);","function")});$("#btnSave").click(function(){objEMSCommonJS.ValidateBlankFields("#frmOrgGroup","#divOrgGroupErrorMessage",objOrgGroupEditJS.ValidateDuplicateFields)?ModalConfirmation(MODAL_HEADER,MSG_CONFIRM,"objEMSCommonJS.PostAjax(true                         , OrgGroupEditURL                         , objOrgGroupEditJS.GetFormData()                         , '#divOrgGroupErrorMessage'                         , '#btnSave'                         , objOrgGroupEditJS.EditSuccessFunction);","function"):$("#tabOrgGroupPosition .errMessage").length>0?objEMSCommonJS.ChangeTab($(".tablinks:nth-child(1)"),"tabOrgGroupPosition"):$("#tabOrgGroupTag .errMessage").length>0?objEMSCommonJS.ChangeTab($(".tablinks:nth-child(3)"),"tabOrgGroupTag"):$("#tabOrgGroupChildren .errMessage").length>0?objEMSCommonJS.ChangeTab($(".tablinks:nth-child(4)"),"tabOrgGroupChildren"):$("#tabOrgGroupNPRF .errMessage").length>0&&objEMSCommonJS.ChangeTab($(".tablinks:nth-child(5)"),"tabOrgGroupNPRF")});$("#btnBack").click(function(){LoadPartial(OrgGroupViewURL+"?ID="+objOrgGroupEditJS.ID,"divOrgGroupBodyModal")})},GetFormData:function(){$(".Attachment_File").each(function(n){$(this).prop("name","OrgGroup.OrgGroupNPRFList["+n+"].File")});var n=new FormData($("#frmOrgGroup").get(0));return $("#ddlListOneOrgGroup option").each(function(t){$(this).val()!=""&&n.append("OrgGroup.ChildrenOrgIDList["+t+"]",$(this).val())}),$(".PositionDynamicFields").each(function(t){$(this).val()!=""&&n.append("OrgGroup.OrgGroupPositionList["+t+"].PositionID",$(this).val())}),$(".PlannedDynamicFields").each(function(t){$(this).val()!=""&&n.append("OrgGroup.OrgGroupPositionList["+t+"].PlannedCount",$(this).val())}),$(".ActiveDynamicFields").each(function(t){$(this).val()!=""&&n.append("OrgGroup.OrgGroupPositionList["+t+"].ActiveCount",$(this).val())}),$(".InactiveDynamicFields").each(function(t){$(this).val()!=""&&n.append("OrgGroup.OrgGroupPositionList["+t+"].InactiveCount",$(this).val())}),$(".IsHeadDynamicFields").each(function(t){$(this).val()!=""&&n.append("OrgGroup.OrgGroupPositionList["+t+"].IsHead",$(this).prop("checked"))}),$(".OrgGroupTagList_Code").each(function(t){$(this).val()!=""&&n.append("OrgGroup.OrgGroupTagList["+t+"].Code",$(this).val())}),$(".OrgGroupTagList_Value").each(function(t){$(this).val()!=""&&n.append("OrgGroup.OrgGroupTagList["+t+"].Value",$(this).val())}),$(".NPRFNumberDynamicFields").each(function(t){$(this).val()!=""&&n.append("OrgGroup.OrgGroupNPRFList["+t+"].NPRFNumber",$(this).val())}),$(".ReportingPositionDynamicFields").each(function(t){$(this).val()!=""&&n.append("OrgGroup.OrgGroupPositionList["+t+"].ReportingPositionID",$(this).val())}),n},GetPositionLevelDropDownOptions:function(){var t=this,n=function(n){$(n.Result).each(function(n,t){PositionLevelDropDownOptions.push({Value:t.Value,Text:t.Text})})};objEMSCommonJS.GetAjax(ViewPositionLevelDropDownURL,{},"",n)},AddChildrenManPowerDynamicFields:function(){var t=$(".ChildrenManPowerDynamicFields:last").prop("id"),n=parseInt(t==undefined?0:t.replace("ChildrenManPowerDynamicFields_",""))+1;$("#DivChildrenManPowerDynamicFields").append('<div class="form-group form-fields ChildrenManPowerDynamicFields" id="ChildrenManPowerDynamicFields_'+n+'">                    <div class="col-md-0-75 text-align-center no-padding">                        <input type="checkbox" id="chkIsHead_'+n+'" class="IsHeadDynamicFields" title="Head" readonly>                    <\/div>                    <div class="col-md-3 text-align-center no-padding">                        <input type ="search" placeholder="Search.." id="txtPosition_'+n+'" class="form-control PositionTextDynamicFields" title="Position" maxlength="100">                        <input type="hidden" id="hdnPositionID_'+n+'" class="form-control PositionDynamicFields">                    <\/div>                    <div class="col-md-3 text-align-center no-padding">                        <input type ="search" placeholder="Search.." id="txtReportingPosition_'+n+'" class="form-control ReportingPositionTextDynamicFields" title="Reporting Position" maxlength="100">                        <input type="hidden" id="hdnReportingPositionID_'+n+'" class="form-control ReportingPositionDynamicFields">                    <\/div>                    <div class="col-md-0-75 text-align-center no-padding">                        <input type="text" id="txtPlanned_'+n+'" class="form-control text-amount PlannedDynamicFields" title="Planned">                    <\/div>                    <div class="col-md-0-75 text-align-center no-padding">                        <input type="text" id="txtActive_'+n+'" class="form-control text-amount ActiveDynamicFields" title="Active" readonly>                    <\/div>                    <div class="col-md-0-75 text-align-center no-padding">                        <input type="text" id="txtInactive_'+n+'" class="form-control text-amount InactiveDynamicFields" title="Inactive" readonly>                    <\/div>                    <div class="col-md-0-75 text-align-right no-padding">                        <label id="txtVariance_'+n+'" class="control-label block-label remarks-label text-amount total-label VarianceDynamicFields"><\/label>                    <\/div>                    <div class="col-md-0-5 text-align-center no-padding">                        <span class="btn-glyph-dynamic glyphicon glyphicon-trash"                         onclick="ModalConfirmation(MODAL_HEADER, MSG_CONFIRM_DELETE_SINGLE, &quot;objOrgGroupEditJS.RemoveDynamicFields(\'#ChildrenManPowerDynamicFields_'+n+"')&quot;, &quot;function&quot;);\"><\/span>                    <\/div>                <\/div>");NumberOnly($(".PlannedDynamicFields"));NumberOnly($(".ActiveDynamicFields"));NumberOnly($(".InactiveDynamicFields"));$("#txtActive_"+n+", #txtInactive_"+n).val("0");$("#txtPlanned_"+n+", #txtActive_"+n+", #txtInactive_"+n).keyup(function(){$("#txtVariance_"+n).val(parseInt($("#txtActive_"+n).val()||0)+parseInt($("#txtInactive_"+n).val()||0)-parseInt($("#txtPlanned_"+n).val()||0));$("#txtVariance_"+n).text(parseInt($("#txtActive_"+n).val()||0)+parseInt($("#txtInactive_"+n).val()||0)-parseInt($("#txtPlanned_"+n).val()||0));objOrgGroupListJS.CalculateTotal("VarianceDynamicFields","txtTotalVariance")});$(".IsHeadDynamicFields").on("change",function(){$(".IsHeadDynamicFields").not(this).prop("checked",!1)});$("#txtPlanned_"+n).keyup(function(){objOrgGroupListJS.CalculateTotal("PlannedDynamicFields","txtTotalPlanned")});$("#txtActive_"+n).keyup(function(){objOrgGroupListJS.CalculateTotal("ActiveDynamicFields","txtTotalActive")});$("#txtInactive_"+n).keyup(function(){objOrgGroupListJS.CalculateTotal("InactiveDynamicFields","txtTotalInactive")});objEMSCommonJS.BindAutoComplete("txtPosition_"+n,PositionWithLevelAutoCompleteURL,20,"hdnPositionID_"+n,"ID","Description");objEMSCommonJS.BindAutoComplete("txtReportingPosition_"+n,PositionWithLevelAutoCompleteURL,20,"hdnReportingPositionID_"+n,"ID","Description")},RemoveDynamicFields:function(n,t){$(n).remove();ModalAlert(MODAL_HEADER,MSG_SUCCESS_DELETE_REC);t!=null&&t()},ValidateDuplicateFields:function(){var n=!0,i=0,r=0,e=$("#hdnParentOrgID").val(),t=0,u,f;return PositionPlannedNew=[],$("#ddlListOneOrgGroup option").each(function(){this.value==e&&this.value!=""&&($("#txtParentOrgGroup").addClass("errMessage"),$("#ddlListOneOrgGroup").addClass("errMessage"),r++)}),$("#divOrgGroupModal .PositionDynamicFields").each(function(){var t,n,r;this.value!=""&&(t=this.value,n=$(this).prop("id").replace("hdnPositionID_",""),$("#ChildrenManPowerDynamicFields_"+n+" #txtPosition_"+n).removeClass("errMessage"),$("#ChildrenManPowerDynamicFields_"+n+" #txtReportingPosition_"+n).removeClass("errMessage"),$("#ChildrenManPowerDynamicFields_"+n+" #txtPlanned_"+n).removeClass("errMessage"),$("#ChildrenManPowerDynamicFields_"+n+" #txtActive_"+n).removeClass("errMessage"),$("#ChildrenManPowerDynamicFields_"+n+" #txtInactive_"+n).removeClass("errMessage"),$(".PositionDynamicFields").not(this).filter(function(){this.value==t&&($("#ChildrenManPowerDynamicFields_"+n+" #txtPosition_"+n).addClass("errMessage"),$("#ChildrenManPowerDynamicFields_"+n+" #txtReportingPosition_"+n).addClass("errMessage"),$("#ChildrenManPowerDynamicFields_"+n+" #txtPlanned_"+n).addClass("errMessage"),$("#ChildrenManPowerDynamicFields_"+n+" #txtActive_"+n).addClass("errMessage"),$("#ChildrenManPowerDynamicFields_"+n+" #txtInactive_"+n).addClass("errMessage"),i++)}),r=$("#ChildrenManPowerDynamicFields_"+n+" #txtPlanned_"+n).val(),PositionPlannedNew.push(this.value+"-"+r))}),r>0&&($("#divOrgGroupErrorMessage").html('<label class="errMessage"><li>'+DUPLICATE_PARENT_ORG_GROUP+"<\/li><\/label><br />"),n=!1),i>0&&($("#divOrgGroupErrorMessage").html('<label class="errMessage"><li>'+DUPLICATE_HIGHLIGHTED_FIELDS+"<\/li><\/label><br />"),n=!1),u=PositionPlannedOld.sort().toString(),f=PositionPlannedNew.sort().toString(),u!=f?($("#divOrgGroupNPRFErrorMessage").html('<label class="errMessage"><li>'+MSG_REQUIRED_NPRF+"<\/li><\/label><br />"),$("#divOrgGroupModal .NPRFNumberDynamicFields, .DateApprovedDynamicFields").addClass("errMessage"),n=!1,$("#divOrgGroupModal .NPRFNumberDynamicFields").each(function(){var n=$(this).prop("id").replace("txtNPRFNumber_","");this.value!=""?$("#txtNPRFNumber_"+n).removeClass("errMessage"):($("#txtNPRFNumber_"+n).addClass("errMessage"),t++)}),$("#divOrgGroupModal .Attachment_File").each(function(){var n=$(this).prop("id").replace("fileAttachment_","");this.value!=""?$("#fileAttachment_"+n).removeClass("errMessage"):($("#fileAttachment_"+n).addClass("errMessage"),t++)}),t==0&&$("#divOrgGroupModal .NPRFNumberDynamicFields").length>0&&($("#divOrgGroupNPRFErrorMessage").html(""),n=!0)):($("#divOrgGroupNPRFErrorMessage").html(""),$("#divOrgGroupModal .NPRFNumberDynamicFields, .DateApprovedDynamicFields").removeClass("errMessage")),n||$("html, body").animate({scrollTop:0},"slow"),n},GetOrgGroupListBoxOptions:function(){var n=function(n){$(n.Result).each(function(n,t){OrgGroupListBoxOptions.push({Value:t.Value,Text:t.Text})})};objEMSCommonJS.GetAjax(ViewOrgGroupDropDownURL,{},"",n)},PopulateListBox:function(n,t){$(t).each(function(t,i){$(n).append($("<option/>",{value:i.Value,text:i.Text}))})},LoadChildrenOrgGroup:function(){$(".listboxbutton, #txtSearchBoxTwo, #ddlListTwoOrgGroup").hide();$("#ddlListOneOrgGroup").prop("disabled",!0);var i=this,n={ID:objOrgGroupEditJS.ID},t=function(n){$(n.Result).each(function(n,t){$("#ddlListOneOrgGroup").append($("<option/>",{value:t.Value,text:t.Text}))})};objEMSCommonJS.GetAjax(GetOrgGroupChildrenURL,n,"",t)},LoadOrgGroupPosition:function(){var i=this,n,t;$("#DivChildrenManPowerDynamicFields").html("");n={ID:objOrgGroupEditJS.ID};t=function(n){var r=function(n,r){i.AddChildrenManPowerDynamicFields(n.PositionLevelID,n.PositionID);$("#txtPlanned_"+r).val(n.PlannedCount);$("#txtActive_"+r).val(n.ActiveCount);$("#txtVariance_"+r).val(parseInt(n.ActiveCount)+parseInt(n.InactiveCount)-parseInt(n.PlannedCount));$("#txtVariance_"+t).text(parseInt(n.ActiveCount)+parseInt(n.InactiveCount)-parseInt(n.PlannedCount));$("#txtInactive_"+r).val(n.InactiveCount);$("#chkIsHead_"+r).attr("checked",n.IsHead);$("#chkIsHead_"+t).val(n.IsHead);$("#txtPosition_"+r).val(n.PositionDescription);$("#hdnPositionID_"+r).val(n.PositionID);$("#txtReportingPosition_"+r).val(n.ReportingPositionDescription);$("#hdnReportingPositionID_"+r).val(n.ReportingPositionID);objOrgGroupListJS.CalculateTotal("PlannedDynamicFields","txtTotalPlanned");objOrgGroupListJS.CalculateTotal("ActiveDynamicFields","txtTotalActive");objOrgGroupListJS.CalculateTotal("InactiveDynamicFields","txtTotalInactive");objOrgGroupListJS.CalculateTotal("VarianceDynamicFields","txtTotalVariance")},t=1;$(n.Result).each(function(n,i){r(i,t);t++;PositionPlannedOld.push(i.PositionID+"-"+i.PlannedCount)})};objEMSCommonJS.GetAjax(GetOrgGroupPositionURL,n,"",t)},LoadOrgGroupNPRF:function(){var i=this,n,t;$("#DivNPRFDynamicFields").html("");n={OrgGroupID:objOrgGroupEditJS.ID};t=function(n){var i=function(n,t){$("#DivNPRFDynamicFields").append('<div class="form-group form-fields NPRFDynamicFields" id="NPRFDynamicFields_'+t+'">                            <div class="col-md-2-5 text-align-center no-padding">                                <input type="text" id="txtNPRFNumber_'+t+'" value="'+n.NPRFNumber+'" maxlength="50" class="form-control" title="NPRFNumber" readonly>                            <\/div>                            <div class="col-md-3 no-padding">                                <label class="control-label block-label">'+n.SourceFile+'<\/label>                                <input type="hidden" id="txtServerFile_ '+t+'" value="'+n.ServerFile+'" class="form-control">                                <input type="hidden" id="txtSourceFile_ '+t+'" value="'+n.SourceFile+'" class="form-control">                            <\/div>                            <div class="col-md-2-5 no-padding">                                <label class="control-label block-label">'+n.UploadedBy+"<br> Timestamp: "+n.Timestamp+'<\/label>                            <\/div>                            <div class="col-md-0-5 no-padding">                                <span class="btn-glyph-dynamic glyphicon glyphicon-download-alt" onclick="objEMSCommonJS.DownloadAttachment(CheckFileIfExistsURL, \'PlantillaService_OrgGroup_Attachment_Path\',\''+n.ServerFile+"', '"+n.SourceFile+"')\"><\/span>                            <\/div>                          <\/div>")},t=1;$(n.Result).each(function(n,r){i(r,t);t++})};objEMSCommonJS.GetAjax(GetOrgGroupNPRFURL,n,"",t)},AddNPRFDynamicFields:function(){var t=$(".NPRFDynamicFields:last").prop("id"),n=parseInt(t==undefined?0:t.replace("NPRFDynamicFields_",""))+1;$("#DivNPRFDynamicFields").append('<div class="form-group form-fields NPRFDynamicFields" id="NPRFDynamicFields_'+n+'">                    <div class="col-md-2-5 text-align-center no-padding">                        <input type="text" id="txtNPRFNumber_'+n+'" maxlength="50" class="form-control NPRFNumberDynamicFields" title="NPRFNumber">                    <\/div>                    <div class="col-md-3 no-padding">                        <input type="file" id="fileAttachment_'+n+'" class="form-control Attachment_File" title="Attachment" accept=".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document">                    <\/div>                    <div class="col-md-2-5 no-padding">                    <\/div>                    <div class="col-md-0-5 text-align-center no-padding">                        <span class="btn-glyph-dynamic glyphicon glyphicon-trash"                         onclick="ModalConfirmation(MODAL_HEADER, MSG_CONFIRM_DELETE_SINGLE, &quot;objOrgGroupEditJS.RemoveDynamicFields(\'#NPRFDynamicFields_'+n+"')&quot;, &quot;function&quot;);\"><\/span>                    <\/div>                  <\/div>")}};objOrgGroupEditJS.Initialize()});