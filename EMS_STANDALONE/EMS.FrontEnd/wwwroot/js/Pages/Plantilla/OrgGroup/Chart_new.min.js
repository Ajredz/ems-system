var objChartJS;const GetOrgChart="/Plantilla/OrgGroup/Chart",OrgGroupAddURL="/Plantilla/OrgGroup/Add",OrgGroupViewURL="/Plantilla/OrgGroup/View",OrgGroupEditURL="/Plantilla/OrgGroup/Edit",OrgGroupDeleteURL="/Plantilla/OrgGroup/Delete",OrgGroupAddPostURL="/Plantilla/OrgGroup/Add",OrgGroupEditPostURL="/Plantilla/OrgGroup/Edit",RegionAddURL="/Plantilla/Region/Add",RegionAddPostURL="/Plantilla/Region/Add",PositionAddURL="/Plantilla/Position/Add",PositionAddPostURL="/Plantilla/Position/Add",ViewPositionByIDURL="/Plantilla/OrgGroup/View?handler=PositionDropDownByID",ViewOrgGroupDropDownURL="/Plantilla/OrgGroup/View?handler=OrgGroupDropDown",ViewPositionLevelDropDownURL="/Plantilla/OrgGroup/View?handler=PositionLevelDropDown",AddRegionDropDownURL="/Plantilla/OrgGroup/Add?handler=RegionDropDown",AddOrgGroupDropDownURL="/Plantilla/OrgGroup/Add?handler=OrgGroupDropDown",AddPositionLevelDropDownURL="/Plantilla/OrgGroup/Add?handler=PositionLevelDropDown",AddPositionDropDownURL="/Plantilla/OrgGroup/Add?handler=PositionDropDown",EditRegionDropDownURL="/Plantilla/OrgGroup/Edit?handler=RegionDropDown",EditOrgGroupDropDownURL="/Plantilla/OrgGroup/Edit?handler=OrgGroupDropDown",EditPositionLevelDropDownURL="/Plantilla/OrgGroup/Edit?handler=PositionLevelDropDown",EditPositionDropDownURL="/Plantilla/OrgGroup/Edit?handler=PositionDropDown",EditPositionByIDURL="/Plantilla/OrgGroup/Edit?handler=PositionDropDownByID";var HiddenOrgGroups=[],HiddenPositions=[],GlobalOrgChartData=[],GlobalPositionData=[];$(document).ready(function(){objChartJS={Initialize:function(){var n=this;n.ElementBinding();n.GetLocalStorage();$("#cbShowPosition").prop("checked")||$(".org-group-clone table").hide();$("#cbShowExisting").prop("checked")||$(".org-group-clone .ex").hide();$("#cbShowActual").prop("checked")||$(".org-group-clone .ac").hide();HiddenOrgGroups=localStorage.OrgChartHiddenOrgGroups!=undefined?localStorage.OrgChartHiddenOrgGroups.split(","):[];HiddenPositions=localStorage.OrgChartHiddenPositions!=undefined?localStorage.OrgChartHiddenPositions.split(","):[];n.LoadOrgChartData()},ElementBinding:function(){var n=this;$("#ddlOrgGroup, #cbShowPosition, #cbShowExisting, #cbShowActual").change(function(){$(this).prop("id")=="ddlOrgGroup"&&(HiddenOrgGroups=[]);$(this).prop("id")=="cbShowPosition"&&(HiddenPositions=[]);$("#cbShowPosition").prop("checked")?(localStorage.OrgChartHiddenPositions=[],localStorage.OrgChartShowPositions=[],$("#cbShowExisting").prop("disabled",!1),$("#cbShowActual").prop("disabled",!1)):($("#cbShowExisting").prop("disabled",!0),$("#cbShowActual").prop("disabled",!0),$("#cbShowExisting").prop("checked",!1),$("#cbShowActual").prop("checked",!1));$(this).prop("id")!="cbShowExisting"&$(this).prop("id")!="cbShowActual"?n.LoadOrgChartData():($("#cbShowExisting").prop("checked")?$(".org-group-leaf .ex").show():$(".org-group-leaf .ex").hide(),$("#cbShowActual").prop("checked")?$(".org-group-leaf .ac").show():$(".org-group-leaf .ac").hide(),n.DrawLines(GlobalOrgChartData));n.SetLocalStorage()});$("#ChartContainer").scroll(function(){localStorage.OrgChartScrollLeft=$("#ChartContainer").scrollLeft();localStorage.OrgChartScrollTop=$("#ChartContainer").scrollTop()});$("#OrgChartReset").mouseup(function(){$("#ChartDrawingDiv").css({zoom:1});n.SetLocalStorage()});$("#OrgChartZoomOut").mouseup(function(){var t=parseFloat($("#ChartDrawingDiv").css("zoom"));t-=.1;t>0&&($("#ChartDrawingDiv").css({zoom:t}),n.SetLocalStorage())});$("#OrgChartZoomIn").mouseup(function(){var t=parseFloat($("#ChartDrawingDiv").css("zoom"));t+=.1;$("#ChartDrawingDiv").css({zoom:t});n.SetLocalStorage()});$("#OrgChartFullScreen").mouseup(function(){$("#OrgChartSmallScreen").show();$("#OrgChartFullScreen").hide();var n=$("#ChartContainer")[0];n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen();$("#ChartContainer").css({height:"100%",width:"100%"})});$("#OrgChartSmallScreen").mouseup(function(){$("#OrgChartSmallScreen").hide();$("#OrgChartFullScreen").show();document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen();$("#ChartContainer").css({height:"auto",width:"auto"})});$("#btnAddOrgGroup").mouseup(function(){LoadPartial(OrgGroupAddURL,"divOrgGroupBodyModal");$("#divOrgGroupModal").modal("show")});$("#btnAddPosition").mouseup(function(){LoadPartial(PositionAddURL,"divPositionBodyModal");$("#divPositionModal").modal("show")})},LoadOrgChartData:function(){var n=this;n.LoadOrgChartPositionData()},AlignParents:function(n){var i=this,t;$(".right_padding, .left_padding").remove();t=function(n,i,r){for(var e,o,s,u=0;u<r.length;u++)if(e=r[u],n==e.ID){o=$("#leaf_id_"+i).parent("div").parent("div").prop("id");s=1;o!=undefined&&(s=parseInt(o.replace("level_","")));var h=$(".children_of_"+i).find("div.org-group-leaf").toArray().length,c=$("#level_"+s).find(".org-group-leaf").eq(-2).prop("id"),f=$("#leaf_id_"+i).width()/2;$(".left_padding_"+n).length==0?$("#leaf_id_"+n).before('<div class="left_padding left_padding_'+n+'" style="width:'+(f-$("#leaf_id_"+n).width()/2+1)+'px"><\/div>'):$(".left_padding_"+n).width($(".left_padding_"+n).width()+f+5);$(".right_padding_"+n).length==0?$("#leaf_id_"+n).after('<div class="right_padding right_padding_'+n+'" style="width:'+(50+f-$("#leaf_id_"+n).width()/2+1)+'px"><\/div>'):$(".right_padding_"+n).width($(".right_padding_"+n).width()+f+5);t(e.ParentOrgID,n,r)}};$(n).each(function(i,r){t(r.ParentOrgID,r.ID,n)});$(".row-level").each(function(n,t){n+1<$(".row-level").length&n+1>1&&$("#"+$(t).prop("id")+" .org-children-div").each(function(n,t){n>0&&$(t).css({"margin-left":5})})});i.DrawLines(n)},DrawOrgChart:function(n){var f=this,e,o,t,s,h,r,i;for($("#ChartDrawingDiv").html(""),e=function(n,t){for(var i,u,f,s,h,r=0;r<t.length;r++)i=t[r],i.ParentOrgID==n&&(o(i,t),u=1,f=$("#leaf_id_"+i.ParentOrgID).parent("div").parent("div").prop("id"),f!=undefined&&(u=parseInt(f.replace("level_",""))),s=Math.max.apply(null,$("div#level_"+u).find(".org-group-leaf").map(function(){return $(this).height()}).get()),$("#level_"+u).css({height:30+s}),h=$.inArray(i.ID.toString(),HiddenOrgGroups),h<0&&e(i.ID,t))},o=function(n,t){var i,e,u,r;$(".org-group-clone").clone().prop("id","leaf_id_"+n.ID).appendTo("#ChartDrawingDiv");$("#ChartDrawingDiv .org-group-clone#leaf_id_"+n.ID).addClass("org-group-leaf");$("#ChartDrawingDiv .org-group-clone#leaf_id_"+n.ID).removeClass("org-group-clone");i="#ChartDrawingDiv .org-group-leaf#leaf_id_"+n.ID;$(i).css({display:"block"});f.DrawOrgChartPosition(n.ID);$("#cbShowPosition").prop("checked")?$(i).find("table").show():($(i).find("table").show(),$(i+" .leaf-position:visible").length>0&&(e=$(i).width(),$(i).width(e)),$(i).find("table").hide());$(".row-level").length==0?($(i).wrap(function(){return"<div class='row-level' id='level_1'><\/div>"}),$(i).wrap(function(){return"<div class='org-children-div children_of_0'><\/div>"})):(u=$("#leaf_id_"+n.ParentOrgID).parent("div").parent("div").prop("id"),u!=undefined&&(r=parseInt(u.replace("level_",""))+1,$("#level_"+r).length>0?$(i).appendTo("#level_"+r):$(i).wrap(function(){return"<div class='row-level' id='level_"+r+"'><\/div>"})),$(".children_of_"+n.ParentOrgID).length>0?$(i).appendTo(".children_of_"+n.ParentOrgID):$(i).wrap(function(){return"<div class='org-children-div children_of_"+n.ParentOrgID+"'><\/div>"}));$(i).find(".leaf-header").append(n.Code+"<br>"+n.Description);$(i).find(".leaf-header-buttons .glyphicon-list").mouseup(function(){var r=$(i).width(),n,t;$(i).find("table").is(":visible")?($(i).find("table").hide(),$(i).width(r)):$(i).find("table").show();n=$(this).parent("div").parent(".org-group-leaf").prop("id").replace("leaf_id_","");t=$.inArray(n.toString(),HiddenPositions);t<0?HiddenPositions.push(n):HiddenPositions.splice(t,1);localStorage.OrgChartHiddenPositions=HiddenPositions;f.DrawLines(GlobalOrgChartData,n)});$(i).find(".leaf-header-buttons .glyphicon-pencil").mouseup(function(){var t=function(){$("#divOrgGroupBodyModal #btnDelete").remove();$("#divOrgGroupBodyModal #btnBack").remove();$("#divOrgGroupBodyModal #btnSave").mouseup(function(){objOrgGroupEditJS.EditSuccessFunction=function(){objChartJS.LoadOrgChartData()}})};LoadPartialSuccessFunction(OrgGroupEditURL+"?ID="+n.ID,"divOrgGroupBodyModal",t);$("#divOrgGroupModal").modal("show")});$(i).find(".leaf-footer-buttons span").mouseup(function(){var n=$(this).parent("div").parent(".org-group-leaf").prop("id").replace("leaf_id_",""),i=$.inArray(n.toString(),HiddenOrgGroups);i<0?HiddenOrgGroups.push(n):HiddenOrgGroups.splice(i,1);localStorage.OrgChartHiddenOrgGroups=HiddenOrgGroups;f.DrawOrgChart(t)});$(i).mouseover(function(){$(i).find(".leaf-header-buttons").show()}).mouseout(function(){$(i).find(".leaf-header-buttons").hide()})},i=0;i<n.length;i++)t=n[i],t.ID==$("#ddlOrgGroup").val()&&(o(t,n),s=$.inArray(t.ID.toString(),HiddenOrgGroups),s<0&&e(t.ID,n));for(i=0;i<n.length;i++){var t=n[i],u="#ChartDrawingDiv .org-group-leaf#leaf_id_"+t.ID,s=$.inArray(t.ID.toString(),HiddenPositions);s>=0&&($("#cbShowPosition").prop("checked")?($(u).find("table").show(),$(u+" .leaf-position:visible").length>0&&(h=$(u).width(),$(u).width(h)),$(u).find("table").hide()):$(u).find("table").show())}for($("#cbShowExisting").prop("checked")?$(".org-group-leaf .ex").show():$(".org-group-leaf .ex").hide(),$("#cbShowActual").prop("checked")?$(".org-group-leaf .ac").show():$(".org-group-leaf .ac").hide(),r=0,$(".org-group-leaf").each(function(){r=r>$(this).position().left+$(this).width()?r:$(this).position().left+$(this).width()}),$("#ChartDrawingDiv").width()>=r&&$(".org-group-leaf").each(function(){$(this).css({left:$(this).position().left+(r>0?($("#ChartDrawingDiv").width()-r)/2:0)})}),i=0;i<n.length;i++){var t=n[i],c=0,l=$(".children_of_"+t.ParentOrgID||0).find("div.org-group-leaf").toArray().length;l==1&&(t.ParentOrgID||0)!=0&&(c=($("#leaf_id_"+t.ParentOrgID).width()-$("#leaf_id_"+t.ID).width())/2,$("#leaf_id_"+t.ID).css({left:$("#leaf_id_"+t.ParentOrgID).position().left+c}))}f.AlignParents(n);$("#ChartDrawingDiv").css({zoom:localStorage.OrgChartZoom==undefined?1:localStorage.OrgChartZoom});$("#ChartContainer").scrollLeft(localStorage.OrgChartScrollLeft||0);$("#ChartContainer").scrollTop(localStorage.OrgChartScrollTop||0);$("#ChartDrawingDiv").height(($(".row-level:first .org-group-leaf:first").length>0?$(".row-level:first .org-group-leaf:first").position().top:0)+Math.max.apply(null,$(".row-level:last .org-group-leaf").map(function(){return $(this).position().top}).get())+100);$("#org-chart-nav-hidden span").appendTo(".org-chart-nav")},LoadOrgChartPositionData:function(){var n=this,t={handler:"ChartPosition",OrgGroupID:$("#ddlOrgGroup").val()},i=function(t){GlobalPositionData=t;var i={handler:"Chart",OrgGroupID:$("#ddlOrgGroup").val()},r=function(t){GlobalOrgChartData=t;n.DrawOrgChart(t)};objEMSCommonJS.GetAjax(GetOrgChart,i,"",r)};objEMSCommonJS.GetAjax(GetOrgChart,t,"",i)},DrawOrgChartPosition:function(n){var t=0;$(GlobalPositionData).each(function(i,r){if(n==r.ID){t++;var u="#ChartDrawingDiv .org-group-leaf#leaf_id_"+r.ID;$(u).find("table > tbody").append('<tr class="leaf-position'+(r.IsHead==!0?"-head":"")+'"><td>'+r.PositionCode+" - "+r.PositionTitle+'<\/td><td class="ex">'+r.ExistingManPower+'<\/td><td class="ac">'+r.ActualManPower+"<\/td><\/tr>")}});t==0&&($("#ChartDrawingDiv .org-group-leaf#leaf_id_"+n).find("table > tbody > tr > th").remove(),$("#ChartDrawingDiv .org-group-leaf#leaf_id_"+n+" .glyphicon-list").remove())},SetLocalStorage:function(){localStorage.OrgChartOrgGroup=$("#ddlOrgGroup").val();localStorage.OrgChartShowPosition=$("#cbShowPosition").prop("checked");localStorage.OrgChartShowExisting=$("#cbShowExisting").prop("checked");localStorage.OrgChartShowActual=$("#cbShowActual").prop("checked");localStorage.OrgChartZoom=$("#ChartDrawingDiv").css("zoom")},GetLocalStorage:function(){$("#ddlOrgGroup").val(localStorage.OrgChartOrgGroup);$("#txtFilterDescription").val(localStorage.PlantillaPositionLevelListDescription);$("#cbShowPosition").prop("checked",JSON.parse(localStorage.OrgChartShowPosition==undefined?!0:localStorage.OrgChartShowPosition||!0));$("#cbShowExisting").prop("checked",JSON.parse(localStorage.OrgChartShowExisting==undefined?!0:localStorage.OrgChartShowExisting||!0));$("#cbShowActual").prop("checked",JSON.parse(localStorage.OrgChartShowActual==undefined?!0:localStorage.OrgChartShowActual||!0))},DrawLines:function(n,t){var o,s,f,i,h,c,v,r,a,u,l,y,b;for(t==null?$(".OrgGroupLines").remove():$("#topBar_"+t+", #bottomBar_"+t+", #horizontalBar_"+t).remove(),o=$("#ChartDrawingDiv").scrollLeft(),s=[],s.push(t),f=0;f<(t!=null?s.length:n.length);f++){for(i=t!=null?s[f]:n[f].ID,h=[],c=0;c<n.length;c++)v=n[c],l=$.inArray((v.ParentOrgID||0).toString(),h),l<0&&h.push((v.ParentOrgID||0).toString());if(r=$("#leaf_id_"+i),a=3,r.length>0){if(u=$("#leaf_id_"+i+" .leaf-footer-buttons span"),h.indexOf(i.toString())>=0?(l=$.inArray(i.toString(),HiddenOrgGroups),l<0?($(u).addClass("glyphicon-chevron-up"),$(u).removeClass("glyphicon-chevron-down")):($(u).addClass("glyphicon-chevron-down"),$(u).removeClass("glyphicon-chevron-up"))):$(u).remove(),(i||0)!=$("#ddlOrgGroup").val()&&$("#leaf_id_"+i).is(":visible")&&(y=$("<div class='OrgGroupLines' id='topBar_"+i+"'><\/div>").css({position:"absolute","background-color":"#000",top:r.position().top-8+"px",height:10+parseInt(r.css("border-bottom-width").replace("px",""))+"px",width:a+"px",left:r.position().left+r.width()/2+parseInt(r.css("margin").replace("px",""))+o+"px"}),$("#ChartDrawingDiv").append(y)),$("div.children_of_"+i+" > div:visible").toArray().length>0){var d=$("#leaf_id_"+i).height(),p=0,w=$("div.children_of_"+(i||0)+" > div:first");p=(w.length>0?w.position().top:0)-(r.position().top+d)-50;b=$("<div class='OrgGroupLines bottomBar' id='bottomBar_"+i+"'><\/div>").css({position:"absolute","background-color":"#000",top:r.position().top+r.height()+parseInt(r.css("margin").replace("px",""))+parseInt(r.css("border-bottom-width").replace("px",""))+"px",height:0+((i||0)!=$("#ddlOrgGroup").val()?p+41:44)+"px",width:a+"px",left:r.position().left+r.width()/2+parseInt(r.css("margin").replace("px",""))+o+"px"});$("#ChartDrawingDiv").append(b)}if($("div.children_of_"+i+" > div:visible").toArray().length>1){var e=$("div.children_of_"+i+" > div.org-group-leaf:first"),k=$("div.children_of_"+i+" > div.org-group-leaf:last"),g=$("<div class='OrgGroupLines' id='horizontalBar_"+i+"'><\/div>").css({position:"absolute","background-color":"#000",top:e.position().top-8+"px",height:a+"px",width:(k.width()-e.width())/2+(k.position().left-e.position().left)+"px",left:e.position().left+e.width()/2+parseInt(r.css("margin").replace("px",""))+o+"px"});$("#ChartDrawingDiv").append(g)}}}}};objChartJS.Initialize()});