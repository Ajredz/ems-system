var objChartJS,objOrgGroupListJS;const GetOrgChart=window.location.pathname,OrgGroupListURL=window.location.pathname+"?handler=List",OrgTypeAutoCompleteURL=window.location.pathname+"?handler=OrgTypeAutoComplete",OrgGroupAddURL=window.location.pathname.replace("/chart","")+"/Add",OrgGroupViewURL=window.location.pathname.replace("/chart","")+"/View",GetOrgGroupChildrenURL=window.location.pathname.replace("/chart","")+"/View?handler=ChildrenOrgDropDown",GetOrgGroupPositionURL=window.location.pathname.replace("/chart","")+"/View?handler=OrgGroupPosition",GetOrgGroupNPRFURL=window.location.pathname.replace("/chart","")+"/View?handler=OrgGroupNPRF",OrgGroupEditURL=window.location.pathname.replace("/chart","")+"/Edit",OrgGroupDeleteURL=window.location.pathname.replace("/chart","/list")+"/Delete",OrgGroupAddPostURL=window.location.pathname.replace("/chart","")+"/Add",OrgGroupEditPostURL=window.location.pathname.replace("/chart","")+"/Edit",PositionAddURL="/Plantilla/Position/Add",PositionAddPostURL="/Plantilla/Position/Add",ViewPositionByIDURL=window.location.pathname.replace("/chart","")+"/View?handler=PositionDropDownByID",ViewOrgGroupDropDownURL=window.location.pathname.replace("/chart","")+"/View?handler=OrgGroupDropDown",ViewPositionLevelDropDownURL=window.location.pathname.replace("/chart","")+"/View?handler=PositionLevelDropDown",PositionDropDownURL=window.location.pathname.replace("/chart","")+"/View?handler=PositionDropDown",EditPositionByIDURL=window.location.pathname.replace("/chart","")+"/View?handler=PositionDropDownByID",GetOrgTypeURL=window.location.pathname+"?handler=ReferenceValue&RefCode=ORGGROUPTYPE",GetOrgGroupTagsByOrgGroupTypeURL=window.location.pathname.replace("/chart","/list")+"?handler=OrgGroupTagsByOrgGroupType&RefCode=",DownloadOrgGroupFormURL=window.location.pathname.replace("/chart","/list")+"?handler=DownloadTemplate&ID=1",UploadInsertOrgGroupURL=window.location.pathname.replace("/chart","/list")+"?handler=UploadInsertOrgGroup",UploadEditOrgGroupURL=window.location.pathname.replace("/chart","/list")+"?handler=UploadEditOrgGroup",GetCheckOrgGroupExportListURL=window.location.pathname.replace("/chart","/list")+"?handler=CheckOrgGroupExportList",DownloadOrgGroupExportListURL=window.location.pathname.replace("/chart","/list")+"?handler=DownloadOrgGroupExportList",OrgTypeHierarchyUpwardURL=window.location.pathname.replace("/chart","/list")+"?handler=OrgGroupHierarchy",OrgTypeEmployeeListURL=window.location.pathname.replace("/chart","")+"/View?handler=OrgGroupEmployeeList",PositionAutoCompleteURL=window.location.pathname.replace("/chart","")+"/View?handler=PositionAutoComplete",OrgGroupNPRFListURL=window.location.pathname.replace("/chart","")+"/View?handler=OrgGroupNPRFList",OrgGroupByOrgTypeDropDownURL=window.location.pathname+"?handler=OrgGroupByOrgType";var PositionWithLevelAutoCompleteURL=window.location.pathname.replace("/chart","/list")+"?handler=PositionWithLevelByAutoComplete",ParentOrgGroupAutoCompleteURL=window.location.pathname.replace("/chart","/list")+"?handler=OrgGroupAutoComplete",HiddenOrgGroups=[],HiddenPositions=[],GlobalOrgChartData=[],GlobalPositionData=[],noChild=[],noChildWithLevel=[],ParentChildCount=[],_maxLevel=1,_level=1;$(document).ready(function(){objOrgGroupListJS={CalculateTotal:function(n,t){for(var u=0,r=$("."+n),i=0;i<r.length;i++)parseInt(r[i].value)&&(u+=parseInt(r[i].value||0));$("#"+t).text(u)}};objChartJS={Initialize:function(){var n=this;n.ElementBinding();n.GetLocalStorage();$("#miniview").hide();$("#ddlChartOrgType").change()},ElementBinding:function(){var n=this;$("#ddlChartOrgType").change(function(){if($(this).val()!=""){var n=function(n){var t=[];$("#ddlChartOrgGroup").html("");$(n.Result).each(function(n,i){t.push({Value:i.Value,Text:i.Text})});objEMSCommonJS.PopulateDropDown("#ddlChartOrgGroup",t);$("#ddlChartOrgGroup").val(localStorage.OrgChartOrgGroup||"")};objEMSCommonJS.GetAjax(OrgGroupByOrgTypeDropDownURL+"&OrgType="+$("#ddlChartOrgType").val(),{},"",n)}localStorage.OrgChartOrgType=$("#ddlChartOrgType").val()||""});$("#miniview").on({mouseenter:function(){$(this).css({position:"fixed",top:$("#ChartContainer").position().top+55-$(window).scrollTop(),right:parseInt($(this).css("right").replace("px"))+35})},mouseleave:function(){$(this).css({position:"absolute",top:$(".org-chart-nav").height()+15,right:5})}});$("#ddlChartOrgGroup").change(function(){localStorage.OrgChartOrgGroup=$("#ddlChartOrgGroup").val()});$("#btnGenerateChart, #cbShowClosedBranches").click(function(){$("#divOrgChartErrorMessage").html("");$("#ddlChartOrgGroup").removeClass("errMessage");$("#ddlChartOrgType").removeClass("errMessage");$("#ddlOrgGroupLevels").removeClass("errMessage");($("#ddlChartOrgGroup").val()||"")!=""&&($("#ddlOrgGroupLevels").val()||"")!=""&&n.LoadOrgChartData();($("#ddlChartOrgGroup").val()||"")==""&&$("#ddlChartOrgGroup").addClass("errMessage");($("#ddlOrgGroupLevels").val()||"")==""&&$("#ddlOrgGroupLevels").addClass("errMessage");($("#ddlChartOrgType").val()||"")==""&&$("#ddlChartOrgType").addClass("errMessage");($("#ddlChartOrgGroup").hasClass("errMessage")||$("#ddlChartOrgType").hasClass("errMessage")||$("#ddlOrgGroupLevels").hasClass("errMessage"))&&$("#divOrgChartErrorMessage").html('<label class="errMessage"><li>'+REQ_HIGHLIGHTED_FIELDS+"<\/li><\/label><br />");n.SetLocalStorage()});$("#ChartContainer").scroll(function(){localStorage.OrgChartScrollLeft=$("#ChartContainer").scrollLeft();localStorage.OrgChartScrollTop=$("#ChartContainer").scrollTop()});$("#OrgChartReset").click(function(){$("#ChartDrawingDiv").css({zoom:1});n.SetLocalStorage()});$("#OrgChartZoomOut").click(function(){var t=parseFloat($("#ChartDrawingDiv").css("zoom"));t-=.1;t>0&&($("#ChartDrawingDiv").css({zoom:t}),n.SetLocalStorage())});$("#OrgChartZoomIn").click(function(){var t=parseFloat($("#ChartDrawingDiv").css("zoom"));t+=.1;$("#ChartDrawingDiv").css({zoom:t});n.SetLocalStorage()});$("#OrgChartFullScreen").click(function(){$("#ChartContainer").unbind("keyup");$("#ChartContainer").keyup(function(n){(n.keyCode==27||n.keyCode==122)&&$("#OrgChartSmallScreen").click()});$(".org-chart-nav").css({position:"fixed"});$("#OrgChartSmallScreen").show();$("#OrgChartFullScreen").hide();var n=$("#ChartContainer")[0];n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen();$("#ChartContainer").css({height:"100%",width:"100%"})});$("#OrgChartSmallScreen").click(function(){$(".org-chart-nav").css({position:"absolute"});$("#OrgChartSmallScreen").hide();$("#OrgChartFullScreen").show();document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen();$("#ChartContainer").css({height:"auto",width:"auto"})});$("#btnAddOrgGroup").click(function(){LoadPartial(OrgGroupAddURL,"divOrgGroupBodyModal");$("#divOrgGroupModal").modal("show")});$("#btnAddPosition").click(function(){LoadPartial(PositionAddURL,"divPositionBodyModal");$("#divPositionModal").modal("show")})},LoadOrgChartData:function(){if(($("#ddlChartOrgGroup").val()||"")!=""&&($("#ddlOrgGroupLevels").val()||"")!=""){var n=this;noChild=[];ParentChildCount=[];$("#ChartDrawingDiv").html("");$("#miniview").html("");$("#ChartDrawingDiv").css({zoom:1});setTimeout(function(){n.LoadOrgChartPositionData()},200)}},DrawOrgChart:function(n){var c=this,f,i,t,h,r;$("#ChartDrawingDiv").html("");var e=function(n,t){for(var i,u,f,h,r=0;r<t.length;r++)if(i=t[r],i.ParentOrgID==n){o(i,t);$("#leaf_id_"+i.ID).css({left:$("#leaf_id_"+i.ParentOrgID).position().left});s(i.ParentOrgID||0,i.ID,t);u=1;f=$("#leaf_id_"+i.ParentOrgID).parent("div").parent("div").prop("id");f!=undefined&&(u=parseInt(f.replace("level_","")));var l=Math.max.apply(null,$("div#level_"+u).find(".org-group-leaf").map(function(){return $(this).height()}).get()),a=Math.max.apply(null,$("div#level_"+u).find(".org-group-leaf").map(function(){return $(this).height()}).get()),c=$("#leaf_id_"+i.ParentOrgID).position().top+l+a,h=$.inArray(i.ID,noChild);h>=0&&$("#leaf_id_"+i.ID).prev().prop("id")!=undefined&&(c=$("#leaf_id_"+i.ID).prev().position().top+$("#leaf_id_"+i.ID).prev().height()+10);$("#leaf_id_"+i.ID).css({top:c});h=$.inArray(i.ID.toString(),HiddenOrgGroups);h<0&&e(i.ID,t)}},o=function(n,t){var i,e,f,r,u;$(".org-group-clone").clone().prop("id","leaf_id_"+n.ID).appendTo("#ChartDrawingDiv");$("#ChartDrawingDiv .org-group-clone#leaf_id_"+n.ID).addClass("org-group-leaf");$("#ChartDrawingDiv .org-group-clone#leaf_id_"+n.ID).removeClass("org-group-clone");i="#ChartDrawingDiv .org-group-leaf#leaf_id_"+n.ID;$(i).css({display:"block"});$("#cbShowPosition").prop("checked")?$(i).find("table").show():($(i).find("table").show(),$(i+" .leaf-position:visible").length>0&&(e=$(i).width(),$(i).width(e)),$(i).find("table").hide());$(".row-level").length==0?($(i).wrap(function(){return"<div class='row-level' id='level_1'><\/div>"}),$(i).wrap(function(){return"<div class='org-children-div children_of_0'><\/div>"})):(f=$("#leaf_id_"+n.ParentOrgID).parent("div").parent("div").prop("id"),f!=undefined&&(r=parseInt(f.replace("level_",""))+1,$("#level_"+r).length>0?$(i).appendTo("#level_"+r):$(i).wrap(function(){return"<div class='row-level' id='level_"+r+"'><\/div>"})),$(".children_of_"+n.ParentOrgID).length>0?$(i).appendTo(".children_of_"+n.ParentOrgID):$(i).wrap(function(){return"<div class='org-children-div children_of_"+n.ParentOrgID+"'><\/div>"}));u=0;$(t).each(function(t,i){i.ParentOrgID==n.ID&&u++});$(i).find(".leaf-header").append(n.Code+"<br>"+n.Description);u>0&&$(i).find(".leaf-header").after().append('<span style="position: absolute;display: inline-table;color: black;top: -10px; right: -10px;">'+u+"<\/span>");$("#hdnHasOrgGroupEditFeature").val()=="true"?$(i).find(".leaf-header-buttons .glyphicon-pencil").click(function(){var t=function(){$("#divOrgGroupBodyModal #btnDelete").remove();$("#divOrgGroupBodyModal #btnBack").remove();$("#divOrgGroupBodyModal #btnSave").click(function(){objOrgGroupEditJS.EditSuccessFunction=function(){objChartJS.LoadOrgChartData()}})};LoadPartialSuccessFunction(OrgGroupEditURL+"?ID="+n.ID,"divOrgGroupBodyModal",t);$("#divOrgGroupModal").modal("show")}):$(i).find(".leaf-header-buttons .glyphicon-pencil").remove();$(i).mouseover(function(){$(i).find(".leaf-header-buttons").show()}).mouseout(function(){$(i).find(".leaf-header-buttons").hide()})},s=function(n,t,i){for(var o,h,r,f=0;f<i.length;f++)if(o=i[f],n==o.ID){h=$("#leaf_id_"+t).parent("div").parent("div").prop("id");r=1;h!=undefined&&(r=parseInt(h.replace("level_","")));var v=$(".children_of_"+t).find("div.org-group-leaf").toArray().length,y=$("#level_"+r).find(".org-group-leaf").eq(-2).prop("id"),u=0;if(y!=undefined&&v<1){u=$("#level_"+r).find(".org-group-leaf").eq(-2).position().left+$("#level_"+r).find(".org-group-leaf").eq(-2).width();u<$("#leaf_id_"+t).position().left&&(u=$("#leaf_id_"+t).position().left);var w=Math.max.apply(null,$("div#level_"+r).find(".org-group-leaf").map(function(){return $(this).height()}).get()),l=u+10,a=$.inArray(t,noChild);a>=0&&$("#leaf_id_"+t).prev().prop("id")!=undefined&&(l=$("#leaf_id_"+t).prev().position().left);$("#leaf_id_"+t).css({left:l})}var c=$("div.children_of_"+n+" .org-group-leaf:first"),p=$("div.children_of_"+n+" .org-group-leaf:last"),e=(p.position().left-c.position().left)/2+c.position().left,l=u+10,a=$.inArray(t,noChild);a>=0&&$("#leaf_id_"+t).prev().prop("id")!=undefined&&(e=Math.max.apply(null,$("div.children_of_"+n).find(".org-group-leaf").map(function(){return $(this).width()}).get()),e=e/2+ +c.position().left);$("#leaf_id_"+n).css({left:e});s(o.ParentOrgID,n,i)}};for(_maxLevel=0,f=function(n,t){for(var i,u,r=0;r<t.length;r++)i=t[r],i.ParentOrgID==n&&(u=0,$(t).each(function(n,t){i.ID==t.ParentOrgID&&u++}),_level++,_maxLevel=_level>_maxLevel?_level:_maxLevel,u==0?(noChild.push(i.ID),noChildWithLevel.push({id:i.ID,level:_level})):ParentChildCount.push({id:i.ID,count:u}),f(i.ID,t));_level--},t=0;t<n.length;t++)i=n[t],i.ID==$("#ddlChartOrgGroup").val()&&(_level=1,f(i.ID,n));for($(noChildWithLevel).each(function(t,i){for(var f,e,o=0,r=0,u=0;u<n.length;u++)f=n[u],i.id==f.ID&&(r=f.ParentOrgID);$(noChild).each(function(t,i){for(var f,u=0;u<n.length;u++)f=n[u],r==f.ParentOrgID&i==f.ID&&o++});e=!1;$(ParentChildCount).each(function(n,t){r==t.id&&(t.count!=o&&(noChild=jQuery.grep(noChild,function(n){return n!=i.id})),e=!0)});(!e||i.level<_maxLevel-1)&&(noChild=jQuery.grep(noChild,function(n){return n!=i.id}))}),t=0;t<n.length;t++)i=n[t],i.ID==$("#ddlChartOrgGroup").val()&&(o(i,n),$("#leaf_id_"+i.ID).css({left:0,top:130}),e(i.ID,n));for(t=0;t<n.length;t++){var i=n[t],u="#ChartDrawingDiv .org-group-leaf#leaf_id_"+i.ID,l=$.inArray(i.ID.toString(),HiddenPositions);l>=0&&($("#cbShowPosition").prop("checked")?($(u).find("table").show(),$(u+" .leaf-position:visible").length>0&&(h=$(u).width(),$(u).width(h)),$(u).find("table").hide()):$(u).find("table").show())}r=0;$(".org-group-leaf").each(function(){r=r>$(this).position().left+$(this).width()?r:$(this).position().left+$(this).width()});$("#ChartDrawingDiv").width()>=r&&$(".org-group-leaf").each(function(){$(this).css({left:$(this).position().left+(r>0?($("#ChartDrawingDiv").width()-r)/2:0)})});c.DrawLines(n);$("#ChartDrawingDiv").height(($(".row-level:first .org-group-leaf:first").length>0?$(".row-level:first .org-group-leaf:first").position().top:0)+Math.max.apply(null,$(".row-level:last .org-group-leaf").map(function(){return $(this).position().top}).get())+100);$("#org-chart-nav-hidden span, #org-chart-nav-hidden #miniview").appendTo(".org-chart-nav");setTimeout(function(){$("#ChartContainer").get(0).scrollWidth>$("#ChartContainer").innerWidth()?$("#miniview").show():$("#miniview").hide();var n=$("#ChartContainer .org-group-leaf, #ChartContainer .OrgGroupLines");$("#ChartContainer").miniview(n);$("#miniview").css({top:$(".org-chart-nav").height()+15,left:"auto",right:5});$("#ChartDrawingDiv").css({zoom:localStorage.OrgChartZoom==undefined?1:localStorage.OrgChartZoom});$("#ChartContainer").scrollLeft(localStorage.OrgChartScrollLeft||0);$("#ChartContainer").scrollTop(localStorage.OrgChartScrollTop||0)},200)},LoadOrgChartPositionData:function(){var n=this,t={handler:"Chart",OrgGroupID:$("#ddlChartOrgGroup").val(),Depth:$("#ddlOrgGroupLevels").val(),ShowClosedBranches:$("#cbShowClosedBranches").prop("checked")},i=function(t){GlobalOrgChartData=t;n.DrawOrgChart(t)};objEMSCommonJS.GetAjax(GetOrgChart,t,"",i,null,!0)},SetLocalStorage:function(){localStorage.OrgChartOrgGroup=$("#ddlChartOrgGroup").val()||"";localStorage.OrgChartDepth=$("#ddlOrgGroupLevels").val()||"";localStorage.OrgChartZoom=$("#ChartDrawingDiv").css("zoom")},GetLocalStorage:function(){$("#ddlChartOrgType").val(localStorage.OrgChartOrgType);$("#ddlOrgGroupLevels").val(localStorage.OrgChartDepth)},DrawLines:function(n,t){var s,e,u,a,h,v,c,i,l,p,d,r;for(t==null?$(".OrgGroupLines").remove():$("#topBar_"+t+", #bottomBar_"+t+", #horizontalBar_"+t).remove(),s=$("#ChartDrawingDiv").scrollLeft(),e=[],e.push(t),r=0;r<(t!=null?e.length:n.length);r++){for(u=t!=null?e[r]:n[r].ID,a=[],h=0;h<n.length;h++)v=n[h],c=$.inArray((v.ParentOrgID||0).toString(),a),c<0&&a.push((v.ParentOrgID||0).toString());if(i=$("#leaf_id_"+u),l=1,i.length>0){var c=$.inArray(u,noChild),f=!1,y=!1;if(c>=0&&($("#leaf_id_"+u).prev().prop("id")!=undefined?f=!0:($(".children_of_"+n[r].ParentOrgID).find(".org-group-leaf").length>1&&(f=!0),y=!0)),(u||0)!=$("#ddlChartOrgGroup").val()&&$("#leaf_id_"+u).is(":visible")&&(p=$("<div class='OrgGroupLines' id='topBar_"+u+"'><\/div>").css({position:"absolute","background-color":"#999999",top:(f?y?$("#leaf_id_"+n[r].ParentOrgID).position().top+$("#leaf_id_"+n[r].ParentOrgID).height()+10:i.prev().position().top+i.prev().height()/2:i.position().top-6)+"px",height:(f?y?i.position().top-$("#leaf_id_"+n[r].ParentOrgID).position().top:(i.height()+i.prev().height())/2+10:11+parseInt(i.css("border-bottom-width").replace("px","")))+"px",width:l+"px",left:(f?i.position().left+i.width()+10:i.position().left+i.width()/2)+parseInt(i.css("margin").replace("px",""))+s+"px"}),$("#ChartDrawingDiv").append(p)),$("div.children_of_"+u+" > div:visible").toArray().length>0){var w=$("#leaf_id_"+u).height(),b=0,k=$("div.children_of_"+(u||0)+" > div:first");b=(k.length>0?k.position().top:0)-(i.position().top+w)-50;d=$("<div class='OrgGroupLines bottomBar' id='bottomBar_"+u+"'><\/div>").css({position:"absolute","background-color":"#999999",top:i.position().top+i.height()+parseInt(i.css("margin").replace("px",""))+parseInt(i.css("border-bottom-width").replace("px",""))+"px",height:0+((u||0)!=$("#ddlChartOrgGroup").val()?b+41:w-10)+"px",width:l+"px",left:i.position().left+i.width()/2+parseInt(i.css("margin").replace("px",""))+s+"px"});$("#ChartDrawingDiv").append(d)}if($("div.children_of_"+u+" > div:visible").toArray().length>1|f){var o=$("div.children_of_"+u+" > div:first"),g=$("div.children_of_"+u+" > div:last"),nt=$("<div class='OrgGroupLines' id='horizontalBar_"+u+"'><\/div>").css({position:"absolute","background-color":"#999999",top:(f?i.position().top+i.height()/2:o.position().top-6)+"px",height:l+"px",width:(f?11:(g.width()-o.width())/2+(g.position().left-o.position().left))+"px",left:(f?i.position().left+i.width()+5:o.position().left+o.width()/2+parseInt(i.css("margin").replace("px","")))+s+"px"});$("#ChartDrawingDiv").append(nt)}}}for(r=0;r<(t!=null?e.length:n.length);r++){var u=t!=null?e[r]:n[r].ID,c=$.inArray(u,noChild),f=!1,y=!1;c>=0&&$("#leaf_id_"+u).prev().prop("id")==undefined&&$(".children_of_"+n[r].ParentOrgID).find(".org-group-leaf").length>1&&$("#bottomBar_"+n[r].ParentOrgID).position()!=undefined&&$("#bottomBar_"+n[r].ParentOrgID).css({left:$("#bottomBar_"+n[r].ParentOrgID).position().left+10})}}};objChartJS.Initialize()});