var objWorkflowEditJS,ApprovalRoleListBoxOptions=[];$(document).ready(function(){objWorkflowEditJS={ID:$("#hdnID").val(),Initialize:function(){var n=this;n.ElementBinding();$("#btnSave").show();$("#divWorkflowModal .form-control").attr("readonly",!1);$("#btnEdit").hide();$("#btnSave, #btnBack").show();$("#DivApproverRoleDynamicFields").html("");$("#divWorkflowApprovalModal .modal-dialog").attr("style","width: 50%");n.GetApprovalRoleListBoxOptions();n.LoadWorkflowStep()},DeleteSuccessFunction:function(){$("#btnSearch").click();$("#divWorkflowModal").modal("hide")},EditSuccessFunction:function(){$("#btnSearch").click();$("#btnBack").click()},ElementBinding:function(){var n=this;Code($("#txtCode"));PreventSpace($("#txtCode"));$("#txtCode").bind("copy paste cut",function(n){n.preventDefault()});$("#divWorkflowBodyModal .close").click(function(){$("#DivApproverRoleDynamicFields").html("")});$("#btnAddWorkflowStepFields").click(function(){var r=$("#DivWorkflowStepDynamicFields .required-field"),t=!0,i=!0;r.each(function(){if($(this).val()=="")return $(this).focus(),t=!1,!1});$(".OrderDynamicFields").each(function(){var t=$(this).prop("id").replace("txtOrder_",""),r=n.ValidateApproverRole(t);if(r>0)return i=!1,!1});t&&($(".required-field").removeClass("errMessage"),i?($("#divWorkflowErrorMessage").html(""),n.AddWorkflowStepDynamicFields()):$("#divWorkflowErrorMessage").html('<label class="errMessage"><li>Approver'+SUFF_REQUIRED+"<\/li><\/label><br />"))});$("#btnDelete").click(function(){ModalConfirmation(MODAL_HEADER,MSG_CONFIRM_DELETE_SINGLE,"objEMSCommonJS.PostAjax(false                       , WorkflowDeleteURL + '?ID=' + objWorkflowEditJS.ID                      , {}                       , '#divWorkflowErrorMessage'                       , '#btnDelete'                       , objWorkflowEditJS.DeleteSuccessFunction);","function")});$("#btnSave").click(function(){objEMSCommonJS.ValidateBlankFields("#frmWorkflow","#divWorkflowErrorMessage",objWorkflowEditJS.ValidateDuplicateFields)&&ModalConfirmation(MODAL_HEADER,MSG_CONFIRM," objEMSCommonJS.PostAjax(true                         , WorkflowEditPostURL                         , objWorkflowEditJS.GetFormData()                         , '#divWorkflowErrorMessage'                         , '#btnSave'                         , objWorkflowEditJS.EditSuccessFunction); ","function")});$("#btnBack").click(function(){$(".listOne, .listboxbutton").hide();$(".listTwo").removeClass("col-md-5");$(".listTwo").addClass("col-md-12");$("#divWorkflowApprovalModal .modal-dialog").attr("style","width: 20%");LoadPartial(WorkflowViewURL+"?ID="+objWorkflowEditJS.ID,"divWorkflowBodyModal")})},GetFormData:function(){var n=new FormData($("#frmWorkflow").get(0));return $(".OrderDynamicFields").each(function(t){$(this).val()!=""&&n.append("Workflow.WorkflowStepList["+t+"].Order",$(this).val())}),$(".StepCodeDynamicFields").each(function(t){var i,r;$(this).val()!=""&&(i=$(this).val(),n.append("Workflow.WorkflowStepList["+t+"].StepCode",i));r=$(this).prop("id").replace("txtStepCode_","");$(".RoleIDDynamicFields_"+r+" option").each(function(r){$(this).val()!=""&&(n.append("Workflow.WorkflowStepList["+t+"].WorkflowStepApproverList["+r+"].StepCode",i),n.append("Workflow.WorkflowStepList["+t+"].WorkflowStepApproverList["+r+"].RoleID",$(this).val()))})}),$(".StepDescriptionDynamicFields").each(function(t){$(this).val()!=""&&n.append("Workflow.WorkflowStepList["+t+"].StepDescription",$(this).val())}),$(".ResultTypeDynamicFields").each(function(t){$(this).val()!=""&&n.append("Workflow.WorkflowStepList["+t+"].ResultType",$(this).val())}),$(".IsRequiredDynamicFields").each(function(t){var i=$(this).is(":checked")?!0:!1;n.append("Workflow.WorkflowStepList["+t+"].IsRequired",i)}),$(".AllowBackflowDynamicFields").each(function(t){var i=$(this).is(":checked")?!0:!1;n.append("Workflow.WorkflowStepList["+t+"].AllowBackflow",i)}),$(".TATDaysDynamicFields").each(function(t){$(this).val()!=""&&n.append("Workflow.WorkflowStepList["+t+"].TATDays",$(this).val())}),n},GetApprovalRoleListBoxOptions:function(){var n=function(n){$(n.Result).each(function(n,t){ApprovalRoleListBoxOptions.push({Value:t.Value,Text:t.Text})})};objEMSCommonJS.GetAjax(EditApproverRoleDropDownURL,{},"",n)},PopulateListBox:function(n,t){$(t).each(function(t,i){$(n).append($("<option/>",{value:i.Value,text:i.Text}))})},AddWorkflowStepDynamicFields:function(){var t=this,i=$(".WorkflowStepDynamicFields:last").prop("id"),n=parseInt(i==undefined?0:i.replace("WorkflowStepDynamicFields_",""))+1,r=n!=1?parseInt($("#txtOrder_"+(n-1)).val())+1:1;$("#DivWorkflowStepDynamicFields").append('<div class="form-group form-fields WorkflowStepDynamicFields" id="WorkflowStepDynamicFields_'+n+'">    <div class="col-md-1 no-padding">        <input id="txtOrder_'+n+'" value="'+r+'" class="form-control OrderDynamicFields text-amount" maxlength="17" title="Order" readonly>    <\/div>    <div class="col-md-2 no-padding">        <input type="text" id="txtStepCode_'+n+'" class="form-control required-field StepCodeDynamicFields" title="Step Code" maxlength="50">    <\/div>    <div class="col-md-2-5 no-padding">        <input type="text" id="txtStepDescription_'+n+'" class="form-control required-field StepDescriptionDynamicFields" title="Step Description" maxlength="255">    <\/div>    <div class="col-md-2 no-padding">        <select id="ddlResultType_'+n+'" title="Result Type" class="form-control required-field ResultTypeDynamicFields"><\/select>    <\/div>    <div class="col-md-1 text-align-center no-padding">        <input type="checkbox" id="chkIsRequired_'+n+'" class="IsRequiredDynamicFields" title="IsRequired">    <\/div>    <div class="col-md-1 text-align-center no-padding">        <input type="checkbox" id="chkAllowBackflow_'+n+'" class="AllowBackflowDynamicFields" title="Allow Back Flow">    <\/div>    <div class="col-md-1 no-padding">        <input type="text" id="txtTATDays_'+n+'" class="form-control text-amount required-field TATDaysDynamicFields" title="TAT Days">    <\/div>    <div class="col-md-1 text-align-center no-padding">        <label id="btnApprover_'+n+'">           <span class="btn-glyph-dynamic glyphicon glyphicon-list" title="Click to add/view approver role"><\/span>        <\/label>    <\/div>    <div class="col-md-0-5 text-align-center no-padding">        <span class="btn-glyph-dynamic glyphicon glyphicon-trash" onclick="ModalConfirmation(MODAL_HEADER, MSG_CONFIRM_DELETE_SINGLE, &quot;objWorkflowEditJS.RemoveDynamicFields(\'#WorkflowStepDynamicFields_'+n+"')&quot;, &quot;function&quot;);\"><\/span>    <\/div><\/div>");t.AddApproverRoleDynamicFields(n);$("#btnApprover_"+n).click(function(){t.LoadWorkflowStepApprover(n);$("#ApproverRoleDynamicFields_"+n).show();$("#divWorkflowApprovalModal").modal("show")});GenerateDropdownValues(EditResultTypeDropDownURL,"ddlResultType_"+n,"Value","Description","","",!1);NumberOnly($("#txtTATDays_"+n))},AddApproverRoleDynamicFields:function(n){var i=this,t=$(".ApproverRoleDynamicFields:last").prop("id"),r=parseInt(t==undefined?0:t.replace("ApproverRoleDynamicFields_",""))+1;if(n==r){$("#DivApproverRoleDynamicFields").append('<div class="form-group form-fields ApproverRoleDynamicFields" id="ApproverRoleDynamicFields_'+n+'">   <div class="col-md-5 listOne">       <input type="text" id="" class="form-control listbox txtSearchBoxOne" placeholder="Search here..."/>       <select id="ddlListOne_'+n+'" class="form-control listbox" size="10"><\/select>   <\/div>   <div class="col-md-2 text-align-center listboxbutton">       <br/>       <br/>       <button type="button" id="btnMoveToListTwoAll_'+n+'" class="btnBlue formbtn btn-transfer">>><\/button>       <button type="button" id="btnMoveToListTwo_'+n+'" class="btnBlue formbtn btn-transfer">><\/button>       <button type="button" id="btnMoveToListOne_'+n+'" class="btnBlue formbtn btn-transfer"><<\/button>       <button type="button" id="btnMoveToListOneAll_'+n+'" class="btnBlue formbtn btn-transfer"><<<\/button>   <\/div>   <div class="col-md-5 listTwo">       <input type="text" id="" class="form-control listbox txtSearchBoxTwo" placeholder="Search here..."/>       <select id="ddlListTwo_'+n+'" class="form-control listbox required-field RoleIDDynamicFields_'+n+'" size="10"><\/select>   <\/div><\/div>');i.PopulateListBox("#ddlListOne_"+n,ApprovalRoleListBoxOptions);$("#btnMoveToListTwo_"+n).click(function(){ListBoxMove("ddlListOne_"+n,"ddlListTwo_"+n,!1,!0)});$("#btnMoveToListOne_"+n).click(function(){ListBoxMove("ddlListTwo_"+n,"ddlListOne_"+n,!1,!0)});$("#btnMoveToListTwoAll_"+n).click(function(){ListBoxMove("ddlListOne_"+n,"ddlListTwo_"+n,!0,!0)});$("#btnMoveToListOneAll_"+n).click(function(){ListBoxMove("ddlListTwo_"+n,"ddlListOne_"+n,!0,!0)});$(".txtSearchBoxOne").on("change keyup keydown",function(){ListBoxSearch("ddlListOne_"+n,$(this).val(),!1)});$(".txtSearchBoxTwo").on("change keyup keydown",function(){ListBoxSearch("ddlListTwo_"+n,$(this).val(),!1)});$("#divWorkflowApprovalHeaderModal .close").click(function(){$("#ApproverRoleDynamicFields_"+n).hide()})}$(".ApproverRoleDynamicFields").hide()},LoadWorkflowStep:function(){var n=this,t,i;$("#DivWorkflowStepDynamicFields").html("");t={handler:"Workflow",ID:objWorkflowEditJS.ID};i=function(t){var r=function(t,i){n.AddWorkflowStepDynamicFields();n.AddApproverRoleDynamicFields(i);$("#txtOrder_"+i).val(t.Order);$("#txtStepCode_"+i).val(t.StepCode);$("#txtStepDescription_"+i).val(t.StepDescription);$("#ddlResultType_"+i).val(t.ResultType);$("#chkIsRequired_"+i).val(t.IsRequired);$("#chkIsRequired_"+i).attr("checked",t.IsRequired);$("#chkAllowBackflow_"+i).val(t.AllowBackflow);$("#chkAllowBackflow_"+i).attr("checked",t.AllowBackflow);$("#txtTATDays_"+i).val(t.TATDays);$(t.WorkflowStepApproverList).each(function(n,t){$(ApprovalRoleListBoxOptions).each(function(n,r){r.Value==t.RoleID&&$("#ddlListTwo_"+i).append($("<option/>",{value:r.Value,text:r.Text}))})})},i=1;$(t.Result.WorkflowStepList).each(function(n,t){r(t,i);i++})};objEMSCommonJS.GetAjax(WorkflowViewURL,t,"",i)},LoadWorkflowStepApprover:function(n){$("#ddlListTwo_"+n+" option").each(function(t,i){$("#ddlListOne_"+n+" option[value='"+i.value+"']").remove()})},RemoveDynamicFields:function(n){var t=parseInt(n==undefined?0:n.replace("#WorkflowStepDynamicFields_",""));$(".WorkflowStepDynamicFields").each(function(){var n=$(this).prop("id").replace("WorkflowStepDynamicFields_","");t<n&&$("#txtOrder_"+n).val($("#txtOrder_"+n).val()-1)});$(n).remove();ModalAlert(MODAL_HEADER,MSG_SUCCESS_DELETE_REC)},ValidateApproverRole:function(n){var t=0,i=$("#ddlListTwo_"+n+" option").length;return i==0?(t++,$("#btnApprover_"+n).attr("style","color: #c40000")):$("#ddlListTwo_"+n+" option").each(function(){this.value==""?(t++,$("#btnApprover_"+n).attr("style","color: #c40000")):$("#btnApprover_"+n).attr("style","color: black")}),t},ValidateDuplicateFields:function(){var n=!0,t=0;return $(".StepCodeDynamicFields").each(function(){if(this.value!=""){var r=this.value,i=$(this).prop("id").replace("txtStepCode_","");$("#WorkflowStepDynamicFields_"+i+" #txtStepCode_"+i).removeClass("errMessage");$("#WorkflowStepDynamicFields_"+i+" #txtStepDescription_"+i).removeClass("errMessage");$("#WorkflowStepDynamicFields_"+i+" #ddlResultType_"+i).removeClass("errMessage");$("#WorkflowStepDynamicFields_"+i+" #txtTATDays_"+i).removeClass("errMessage");$(".StepCodeDynamicFields").not(this).filter(function(){this.value==r&&($("#WorkflowStepDynamicFields_"+i+" #txtStepCode_"+i).addClass("errMessage"),$("#WorkflowStepDynamicFields_"+i+" #txtStepDescription_"+i).addClass("errMessage"),$("#WorkflowStepDynamicFields_"+i+" #ddlResultType_"+i).addClass("errMessage"),$("#WorkflowStepDynamicFields_"+i+" #txtTATDays_"+i).addClass("errMessage"),t++)});hasNoApprover=objWorkflowEditJS.ValidateApproverRole(i);hasNoApprover>0&&($("#divWorkflowErrorMessage").html('<label class="errMessage"><li>Approver'+SUFF_REQUIRED+"<\/li><\/label><br />"),n=!1)}}),t>0&&($("#divWorkflowErrorMessage").html('<label class="errMessage"><li>'+DUPLICATE_HIGHLIGHTED_FIELDS+"<\/li><\/label><br />"),n=!1),n||$("html, body").animate({scrollTop:0},"slow"),n}};objWorkflowEditJS.Initialize()});
