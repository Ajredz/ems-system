var objUpdateLogActivityJS;$(document).ready(function(){objUpdateLogActivityJS={Initialize:function(){var n=this;$("#divLogActivityModal label[for='ddlType'] span,                     #divLogActivityModal label[for='ddlTitle'] span,                     #divLogActivityModal label[for='ddlStatus'] span,                     #divLogActivityModal label[for='txtTitle'] span").removeClass("reqField");$("#divLogActivityModal label[for='ddlType'] span,                    #divLogActivityModal label[for='ddlTitle'] span,                    #divLogActivityModal label[for='ddlStatus'] span,                    #divLogActivityModal label[for='txtTitle'] span").addClass("unreqField");$("#divLogActivityModal #btnEditActivity").show();n.ElementBinding();n.GetAttachmentTypeDropDownOptions();logActivityDeletedAttachments=[];objUpdateLogActivityJS.LoadLogActivityStatusHistoryJQGrid({ID:$("#hdnApplicantLogActivityID").val()});$("#lblHeaderType").text($("#ddlType option:selected").text());n.GetComment();n.GetAttachment();objEMSCommonJS.ChangeTab($("#divLogActivityModal .tablinks:nth-child(1)"),"tabHistory","#divLogActivityModal")},ElementBinding:function(){var n=this;$("#btnSaveActivity").click(function(){objEMSCommonJS.ValidateBlankFields("#frmLogActivity","#divLogActivityErrorMessage")&&ModalConfirmation(MODAL_HEADER,MSG_CONFIRM,"objEMSCommonJS.PostAjax(true                         , UpdateApplicantLogActivityPostURL                         , objUpdateLogActivityJS.GetFormData()                         , '#divLogActivityErrorMessage'                         , '#btnSaveActivity'                         , objUpdateLogActivityJS.UpdateSuccessFunction);","function")});$("#divLogActivityModal #btnEditActivity").click(function(){$("#divLogActivityModal #ddlStatus, #divLogActivityModal #txtRemarks").attr("readonly",!1);$("#divLogActivityModal label[for='ddlStatus'] span").addClass("reqField");$("#divLogActivityModal label[for='ddlStatus'] span").removeClass("unreqField");$("#divLogActivityModal #btnEditActivity").hide();$("#divLogActivityModal #btnSaveActivity").show();$("#divLogActivityModal #btnBackActivity").show()});$("#divLogActivityModal #btnBackActivity").click(function(){$("#divLogActivityModal #ddlStatus, #divLogActivityModal #txtRemarks").attr("readonly",!0);$("#divLogActivityModal label[for='ddlStatus'] span").addClass("reqField");$("#divLogActivityModal label[for='ddlStatus'] span").removeClass("unreqField");$("#divLogActivityModal #btnEditActivity").show();$("#divLogActivityModal #btnSaveActivity").hide();$("#divLogActivityModal #btnBackActivity").hide()});$("#btnSaveComment").click(function(){$("#txtAreaComments").val()!=""?objEMSCommonJS.PostAjax(!0,SaveApplicantCommentsURL,objUpdateLogActivityJS.GetCommentSectionFormData(),"#divLogActivityErrorMessage","#btnSaveComment",objUpdateLogActivityJS.GetComment,null,!0):$("#txtAreaComments").focus()});$("#txtAssignedUser").autocomplete({source:function(n,t){$.ajax({url:ReferredByAutoComplete,type:"GET",dataType:"json",data:{Term:$("#txtAssignedUser").val(),TopResults:20},success:function(n){n.IsSuccess?t($.map(n.Result,function(n){return{label:n.Description,value:n.ID}})):ModalAlert(MODAL_HEADER,n.Result)},error:function(n){ModalAlert(MODAL_HEADER,n.responseText)}})},select:function(n,t){return t.item.label!=null,!1},change:function(n,t){t.item==null?($("#hdnAssignedUserID").val(0),$(this).val("")):($("#hdnAssignedUserID").val(t.item.value),$(this).val(t.item.label))},focus:function(n,t){$(this).val(t.item.label);n.preventDefault()}});$("#btnSaveAttachmentActivity").click(function(){var n=function(){return $(".LogActivity_Attachment_Type").length==0?($("#frmLogActivity #divLogActivityErrorMessage").html('<label class="errMessage"><li>Please click plus icon to add attachment<\/li><\/label><br />'),!1):!0};objEMSCommonJS.ValidateBlankFields("#frmLogActivity #DivLogActivityUploadAttachmentDynamicFields","#divLogActivityErrorMessage",n)&&ModalConfirmation(MODAL_HEADER,MSG_CONFIRM,"objEMSCommonJS.PostAjax(true                         , SaveApplicantAttachmentURL                         , objUpdateLogActivityJS.GetAttachmentSectionFormData()                         , '#divLogActivityErrorMessage'                         , '#btnSaveAttachmentActivity'                         , objUpdateLogActivityJS.AttachmentUpdateSuccessFunction);","function")});$("#btnLogActivityAddAttachmentFields").click(function(){var i=$("#DivLogActivityUploadAttachmentDynamicFields .required-field"),t=!0;i.each(function(){if($(this).val()=="")return $(this).focus(),t=!1,!1});t&&n.AddAttachmentDynamicFields()})},GetFormData:function(){var n=new FormData($("#frmLogActivity").get(0));return n.append("ApplicantLogActivityForm.ApplicantID",$("#hdnID").val()),n},UpdateSuccessFunction:function(){$("#divLogActivityModal").modal("hide");objChecklistListJS.LoadJQGrid({TypeDelimited:localStorage.ChecklistListType,Title:localStorage.ChecklistListTitle,Description:localStorage.ChecklistListDescription,CurrentStatusDelimited:localStorage.ChecklistListCurrentStatus,CurrentTimestampFrom:localStorage.ChecklistListCurrentTimestampFrom,CurrentTimestampTo:localStorage.ChecklistListCurrentTimestampTo})},AttachmentUpdateSuccessFunction:function(){LoadPartial(UpdateLogActivityURL+"?ID="+$("#hdnApplicantLogActivityID").val()+"&ApplicantID="+$("#hdnApplicantID").val(),"divLogActivityBodyModal")},LoadLogActivityStatusHistoryJQGrid:function(n){var t=this;Loading(!0);$("#tblLogActivityStatusHistoryList").jqGrid("GridUnload");$("#tblLogActivityStatusHistoryList").jqGrid("GridDestroy");$("#tblLogActivityStatusHistoryList").jqGrid({url:GetApplicantLogActivityStatusHistoryURL,postData:n,sortname:"",sortorder:"",selrow:"",pageNumber:1,rowNum:1e4,datatype:"json",mtype:"GET",colNames:["","Status","Timestamp","User","Remarks"],colModel:[{name:"ID",index:"",hidden:!0},{name:"Status",index:"Status",align:"center",sortable:!1},{name:"Timestamp",index:"Timestamp",align:"center",sortable:!1},{name:"User",index:"User",align:"left",sortable:!1},{name:"Remarks",index:"Remarks",align:"left",sortable:!1},],rowList:SetRowList(),loadonce:!1,viewrecords:!0,jsonReader:{root:"rows",page:"page",total:"total",records:"records",repeatitems:!1},emptyrecords:"No records to display",multiselect:!1,rowNumbers:!0,width:"100%",height:"100%",sortable:!0,loadComplete:function(n){if(Loading(!1),n.IsSuccess!=undefined&&(n.IsSuccess||($("#divErrorMessage").html(""),ModalAlert(MODAL_HEADER,n.Result))),n.rows!=null&&n.rows.length>0)for(var t=0;t<n.rows.length;t++);},loadError:function(n){ModalAlert(MODAL_HEADER,n.responseText);Loading(!1)}})},UpdateLink:function(n,t,i){return"<a href=\"\" class='activity-id-link' onclick=\"return LoadPartial('"+ApplicantViewURL+"?ID="+i.ID+"', 'divApplicantBodyModal');\">Update<\/a>"},AddPreloadedSuccessFunction:function(){objUpdateLogActivityJS.LoadLogActivityJQGrid({ApplicantID:$("#hdnID").val()})},GetComment:function(){var t={ID:$("#hdnApplicantLogActivityID").val()},n;$("#txtAreaComments").val("");n=function(n){n.IsSuccess==!0&&($("#divCommentsContainer").html(""),n.Result.length>0?($("#divCommentsContainer").append("<span class='comment-header'>-- Start --<\/span>"),$(n.Result).each(function(t,i){$("#divCommentsContainer").append("<span class='comment-details'>"+i.Timestamp+" "+i.Sender+": <\/span><span class='comment'> "+i.Comments+"<\/span><br>");n.Result.length<=t+1&&setTimeout(function(){$("#divCommentsContainer").scrollTop($("#divCommentsContainer")[0].scrollHeight)},300)})):$("#divCommentsContainer").append("<span class='comment-header'>-- No comments found. --<\/span>"),$("#txtAreaComments").attr("readonly",!1),$("#txtAreaComments").prop("disabled",!1))};objEMSCommonJS.GetAjax(GetApplicantCommentsURL,t,"",n)},GetAttachment:function(){var i=this,n={ID:$("#hdnApplicantID").val()},t=function(n){var i,t;$("#DivLogActivityDownloadAttachmentDynamicFields").html("");i=function(n,t){var r=$(".LogActivityAttachmentDynamicFields:last").prop("id"),i=parseInt(r==undefined?0:r.replace("LogActivityAttachmentDynamicFields_",""))+1;$("#DivLogActivityDownloadAttachmentDynamicFields").append('<div class="form-group form-fields LogActivityAttachmentDynamicFields" id="LogActivityAttachmentDynamicFields_'+i+'">    <div class="col-md-1-5 no-padding">        <select id="ddlType_'+i+'" class= "form-control required-field LogActivity_Attachment_Type" title="Attachment Type"><\/select >    <\/div>    <div class="col-md-2-5 no-padding">        <textarea rows="3" cols="10" wrap="hard" id="txtRemarks_'+i+'" maxlength="255" class="form-control LogActivity_Attachment_Remarks" title="Remarks"><\/textarea>    <\/div>    <div class="col-md-3-5 no-padding">        <label class="control-label block-label LogActivity_Attachment_File"> <span class="unreqField">* <\/span>'+n.SourceFile+'<\/label>        <input type="hidden" id="txtServerFile_ '+i+'" value="'+n.ServerFile+'" class="form-control LogActivity_Attachment_ServerFile">        <input type="hidden" id="txtSourceFile_ '+i+'" value="'+n.SourceFile+'" class="form-control LogActivity_Attachment_SourceFile">    <\/div>    <div class="col-md-3-5 no-padding">        <label class="control-label block-label"> <span class="unreqField">* <\/span>'+n.UploadedBy+"<br> Timestamp: "+n.Timestamp+'<\/label>    <\/div>    <div class="col-md-0-5 no-padding">        <span class="btn-glyph-dynamic glyphicon glyphicon-trash" onclick="ModalConfirmation(MODAL_HEADER, MSG_CONFIRM_DELETE_SINGLE, &quot;objUpdateLogActivityJS.RemoveDynamicFields(\'#LogActivityAttachmentDynamicFields_'+i+"',objUpdateLogActivityJS.DeleteAttachmentFunction(&#39;"+n.ServerFile+'&#39;))&quot;, &quot;function&quot;);"><\/span>    <\/div>     <div class="col-md-0-5 no-padding">         <span class="btn-glyph-dynamic glyphicon glyphicon-download-alt" onclick="objEMSCommonJS.DownloadAttachment(CheckFileIfExistsURL, \'WorkflowService_LogActivity_Attachment_Path\',\''+n.ServerFile+"', '"+n.SourceFile+"')\"><\/span>     <\/div><\/div>");objEMSCommonJS.PopulateDropDown("#DivLogActivityDownloadAttachmentDynamicFields #ddlType_"+i,LogActivityAttachmentTypeDropDownOptions);$("#DivLogActivityDownloadAttachmentDynamicFields #ddlType_"+t).val(n.AttachmentType);$("#DivLogActivityDownloadAttachmentDynamicFields #txtRemarks_"+t).val(n.Remarks)};n.IsSuccess==!0&&($("#divAttachmentContainer").html(""),n.Result.length>0&&(t=1,$(n.Result).each(function(n,r){i(r,t);t++})))};objEMSCommonJS.GetAjax(GetApplicantAttachmentURL,n,"",t)},GetCommentSectionFormData:function(){var n=new FormData($("#frmLogActivity").get(0));return n.append("CommentsForm.ApplicantLogActivityID",$("#hdnApplicantLogActivityID").val()),n.append("CommentsForm.Comments",$("#txtAreaComments").val()),n},GetAttachmentSectionFormData:function(){$(".LogActivity_Attachment_Type").each(function(n){$(this).prop("name","AttachmentForm.AddAttachmentForm["+n+"].AttachmentType")});$(".LogActivity_Attachment_Remarks").each(function(n){$(this).prop("name","AttachmentForm.AddAttachmentForm["+n+"].Remarks")});$(".LogActivity_Attachment_ServerFile").each(function(n){$(this).prop("name","AttachmentForm.AddAttachmentForm["+n+"].ServerFile")});$(".LogActivity_Attachment_SourceFile").each(function(n){$(this).prop("name","AttachmentForm.AddAttachmentForm["+n+"].SourceFile")});$(".LogActivity_Attachment_File").each(function(n){$(this).prop("name","AttachmentForm.AddAttachmentForm["+n+"].File")});var n=new FormData($("#frmLogActivity").get(0));return n.append("AttachmentForm.ApplicantID",$("#hdnApplicantID").val()),$(logActivityDeletedAttachments).each(function(t,i){n.append("AttachmentForm.DeleteAttachmentForm["+t+"].ServerFile",i.value)}),n},GetAttachmentTypeDropDownOptions:function(){var t=this,n;LogActivityAttachmentTypeDropDownOptions=[];n=function(n){$(n.Result).each(function(n,t){LogActivityAttachmentTypeDropDownOptions.push({Value:t.Value,Text:t.Description})})};objEMSCommonJS.GetAjax(AttachmentTypeDropDown,{},"",n)},RemoveDynamicFields:function(n,t){$(n).remove();ModalAlert(MODAL_HEADER,MSG_SUCCESS_DELETE_REC);t!=null&&t()},DeleteAttachmentFunction:function(n){logActivityDeletedAttachments.push(n)},AddAttachmentDynamicFields:function(){var i=this,t=$(".LogActivityAttachmentDynamicFields:last").prop("id"),n=parseInt(t==undefined?0:t.replace("LogActivityAttachmentDynamicFields_",""))+1;$("#DivLogActivityUploadAttachmentDynamicFields").append('<div class="form-group form-fields LogActivityAttachmentDynamicFields" id="LogActivityAttachmentDynamicFields_'+n+'">    <div class="col-md-1-5 no-padding">        <select id="ddlType_'+n+'" class= "form-control required-field LogActivity_Attachment_Type" title="Attachment Type"><\/select >    <\/div>    <div class="col-md-2-5 no-padding">        <textarea rows="3" cols="10" wrap="hard" id="txtRemarks_'+n+'" maxlength="255" class="form-control LogActivity_Attachment_Remarks" title="Remarks"><\/textarea>    <\/div>    <div class="col-md-3-5 no-padding">        <input type="file" id="fileAttachment_'+n+'" class="form-control required-field LogActivity_Attachment_File" title="Attachment" accept=".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document">    <\/div>    <div class="col-md-3-5 no-padding">    <\/div>    <div class="col-md-0-5 no-padding">        <span class="btn-glyph-dynamic glyphicon glyphicon-trash" onclick="ModalConfirmation(MODAL_HEADER, MSG_CONFIRM_DELETE_SINGLE, &quot;objApplicantListJS.RemoveDynamicFields(\'#LogActivityAttachmentDynamicFields_'+n+"')&quot;, &quot;function&quot;);\"><\/span>    <\/div><\/div>");objEMSCommonJS.PopulateDropDown("#ddlType_"+n,LogActivityAttachmentTypeDropDownOptions)}};objUpdateLogActivityJS.Initialize()});
