var objUpdateAccountabilityJS;$(document).ready(function(){objUpdateAccountabilityJS={Initialize:function(){var n=this;$("#divAccountabilityModal .form-control").attr("disabled",!0);$("#divAccountabilityModal label[for='ddlType'] span,                     #divAccountabilityModal label[for='ddlTitle'] span,                     #divAccountabilityModal label[for='ddlStatus'] span,                     #divAccountabilityModal label[for='txtTitle'] span").removeClass("reqField");$("#divAccountabilityModal label[for='ddlType'] span,                    #divAccountabilityModal label[for='ddlTitle'] span,                    #divAccountabilityModal label[for='ddlStatus'] span,                    #divAccountabilityModal label[for='txtTitle'] span").addClass("unreqField");$("#divAccountabilityModal #btnEditAccountability").show();n.ElementBinding();n.GetAttachmentTypeDropDownOptions();AccountabilityDeletedAttachments=[];objUpdateAccountabilityJS.LoadAccountabilityStatusHistoryJQGrid({ID:$("#hdnEmployeeAccountabilityID").val()});$("#lblHeaderType").text($("#ddlType option:selected").text());n.GetComment();n.GetAttachment();objEMSCommonJS.ChangeTab($(".tablinks:nth-child(1)"),"tabHistory","#divAccountabilityModal")},ElementBinding:function(){var n=this;$("#btnSaveAccountability").click(function(){$("#divAccountabilityModal .form-control").attr("disabled",!1);objEMSCommonJS.ValidateBlankFields("#frmAccountability","#divAccountabilityErrorMessage")&&ModalConfirmation(MODAL_HEADER,MSG_CONFIRM,"objEMSCommonJS.PostAjax(true                         , UpdateAccountabilityPostURL                         , objUpdateAccountabilityJS.GetFormData()                         , '#divAccountabilityErrorMessage'                         , '#btnSaveAccountability'                         , objUpdateAccountabilityJS.UpdateSuccessFunction);","function")});$("#divAccountabilityModal #btnEditAccountability").click(function(){window.location.pathname.indexOf("all")>=0?($("#divAccountabilityModal .form-control").attr("disabled",!1),$("#divAccountabilityModal .form-control").attr("readonly",!1)):window.location.pathname.indexOf("my")>=0?($("#divAccountabilityModal #ddlStatus, #divAccountabilityModal #txtRemarks").attr("disabled",!1),$("#divAccountabilityModal #ddlStatus, #divAccountabilityModal #txtRemarks").attr("readonly",!1),$("#divAccountabilityModal #ddlStatus option[value!='']option[value!='ACCEPTED']").remove()):($("#divAccountabilityModal #ddlStatus, #divAccountabilityModal #txtRemarks").attr("disabled",!1),$("#divAccountabilityModal #ddlStatus, #divAccountabilityModal #txtRemarks").attr("readonly",!1));$("#divAccountabilityModal #btnEditAccountability").hide();$("#divAccountabilityModal #btnSaveAccountability").show();$("#divAccountabilityModal #btnBackAccountability").show()});$("#divAccountabilityModal #btnBackAccountability").click(function(){window.location.pathname.indexOf("all")>=0&&$("#divAccountabilityModal .form-control").attr("disabled",!0);$("#divAccountabilityModal #ddlStatus, #divAccountabilityModal #txtRemarks").attr("readonly",!1);$("#divAccountabilityModal label[for='ddlStatus'] span").removeClass("reqField");$("#divAccountabilityModal label[for='ddlStatus'] span").addClass("unreqField");$("#divAccountabilityModal #btnEditAccountability").show();$("#divAccountabilityModal #btnSaveAccountability").hide();$("#divAccountabilityModal #btnBackAccountability").hide()});$("#btnSaveAccountabilityComment").click(function(){$("#divAccountabilityModal #txtAreaComments").val()!=""?objEMSCommonJS.PostAjax(!0,SaveAccountabilityCommentsURL,objUpdateAccountabilityJS.GetCommentSectionFormData(),"#divAccountabilityErrorMessage","#btnSaveAccountabilityComment",objUpdateAccountabilityJS.GetComment,null,!0):$("#divAccountabilityModal #txtAreaComments").focus()});$("#btnSaveAttachmentAccountability").click(function(){var n=function(){return $(".Accountability_Attachment_Type").length==0?($("#frmAccountability #divAccountabilityErrorMessage").html('<label class="errMessage"><li>Please click plus icon to add attachment<\/li><\/label><br />'),!1):!0};objEMSCommonJS.ValidateBlankFields("#frmAccountability #DivAccountabilityUploadAttachmentDynamicFields","#divAccountabilityErrorMessage",n)&&ModalConfirmation(MODAL_HEADER,MSG_CONFIRM,"objEMSCommonJS.PostAjax(true                         , SaveAccountabilityAttachmentURL                         , objUpdateAccountabilityJS.GetAttachmentSectionFormData()                         , '#divAccountabilityErrorMessage'                         , '#btnSaveAttachmentAccountability'                         , objUpdateAccountabilityJS.AttachmentUpdateSuccessFunction);","function")});$("#btnAccountabilityAddAttachmentFields").click(function(){var i=$("#DivAccountabilityUploadAttachmentDynamicFields .required-field"),t=!0;i.each(function(){if($(this).val()=="")return $(this).focus(),t=!1,!1});t&&n.AddAttachmentDynamicFields()});objEMSCommonJS.BindAutoComplete("txtOrgGroup",OrgGroupAutoCompleteURL,20,"hdnOrgGroup","ID","Description")},GetFormData:function(){var n=new FormData($("#frmAccountability").get(0));return n.append("EmployeeAccountabilityForm.EmployeeID",$("#divEmployeeModal #hdnID").val()),n},UpdateSuccessFunction:function(){LoadPartial(UpdateAccountabilityURL+"?ID="+$("#hdnEmployeeAccountabilityID").val(),"divAccountabilityBodyModal")},AttachmentUpdateSuccessFunction:function(){LoadPartial(UpdateAccountabilityURL+"?ID="+$("#hdnEmployeeAccountabilityID").val(),"divAccountabilityBodyModal")},LoadAccountabilityStatusHistoryJQGrid:function(n){var t=this;Loading(!0);$("#tblAccountabilityStatusHistoryList").jqGrid("GridUnload");$("#tblAccountabilityStatusHistoryList").jqGrid("GridDestroy");$("#tblAccountabilityStatusHistoryList").jqGrid({url:GetAccountabilityStatusHistoryURL,postData:n,sortname:"",sortorder:"",selrow:"",pageNumber:1,rowNum:1e4,datatype:"json",mtype:"GET",colNames:["Status","Timestamp","User","Remarks"],colModel:[{name:"Status",index:"Status",align:"center",sortable:!1},{name:"Timestamp",index:"Timestamp",align:"center",sortable:!1},{name:"User",index:"User",align:"left",sortable:!1},{name:"Remarks",index:"Remarks",align:"left",sortable:!1},],rowList:SetRowList(),loadonce:!1,viewrecords:!0,jsonReader:{root:"rows",page:"page",total:"total",records:"records",repeatitems:!1},emptyrecords:"No records to display",multiselect:!1,rowNumbers:!0,width:"100%",height:"100%",sortable:!0,loadComplete:function(n){if(Loading(!1),n.IsSuccess!=undefined&&(n.IsSuccess||($("#divErrorMessage").html(""),ModalAlert(MODAL_HEADER,n.Result))),n.rows!=null&&n.rows.length>0)for(var t=0;t<n.rows.length;t++);},loadError:function(n){ModalAlert(MODAL_HEADER,n.responseText);Loading(!1)}})},UpdateLink:function(n,t,i){return"<a href=\"\" class='Accountability-id-link' onclick=\"return LoadPartial('"+EmployeeViewURL+"?ID="+i.ID+"', 'divEmployeeBodyModal');\">Update<\/a>"},AddPreloadedSuccessFunction:function(){objUpdateAccountabilityJS.LoadAccountabilityJQGrid({EmployeeID:$("#divEmployeeModal #hdnID").val()})},GetComment:function(){var t={ID:$("#hdnEmployeeAccountabilityID").val()},n;$("#txtAreaComments").val("");n=function(n){n.IsSuccess==!0&&($("#divCommentsContainer").html(""),n.Result.length>0?($("#divCommentsContainer").append("<span class='comment-header'>-- Start --<\/span>"),$(n.Result).each(function(t,i){$("#divCommentsContainer").append("<span class='comment-details'>"+i.Timestamp+" "+i.Sender+": <\/span><span class='comment'> "+i.Comments+"<\/span><br>");n.Result.length<=t+1&&setTimeout(function(){$("#divCommentsContainer").scrollTop($("#divCommentsContainer")[0].scrollHeight)},300)})):$("#divCommentsContainer").append("<span class='comment-header'>-- No comments found. --<\/span>"),$("#txtAreaComments").attr("readonly",!1),$("#txtAreaComments").prop("disabled",!1))};objEMSCommonJS.GetAjax(GetAccountabilityCommentsURL,t,"",n)},GetAttachment:function(){var i=this,n={ID:$("#hdnEmployeeAccountabilityID").val()},t=function(n){var i,t;$("#DivAccountabilityDownloadAttachmentDynamicFields").html("");i=function(n,t){var r=$(".AccountabilityAttachmentDynamicFields:last").prop("id"),i=parseInt(r==undefined?0:r.replace("AccountabilityAttachmentDynamicFields_",""))+1;$("#DivAccountabilityDownloadAttachmentDynamicFields").append('<div class="form-group form-fields AccountabilityAttachmentDynamicFields" id="AccountabilityAttachmentDynamicFields_'+i+'">    <div class="col-md-1-5 no-padding">        <select id="ddlType_'+i+'" class= "form-control required-field Accountability_Attachment_Type" title="Attachment Type"><\/select >    <\/div>    <div class="col-md-2-5 no-padding">        <textarea rows="3" cols="10" wrap="hard" id="txtRemarks_'+i+'" maxlength="255" class="form-control Accountability_Attachment_Remarks" title="Remarks"><\/textarea>    <\/div>    <div class="col-md-3-5 no-padding">        <label class="control-label block-label Accountability_Attachment_File"> <span class="unreqField">* <\/span>'+n.SourceFile+'<\/label>        <input type="hidden" id="txtServerFile_ '+i+'" value="'+n.ServerFile+'" class="form-control Accountability_Attachment_ServerFile">        <input type="hidden" id="txtSourceFile_ '+i+'" value="'+n.SourceFile+'" class="form-control Accountability_Attachment_SourceFile">    <\/div>    <div class="col-md-3-5 no-padding">        <label class="control-label block-label"> <span class="unreqField">* <\/span>'+n.UploadedBy+"<br> Timestamp: "+n.Timestamp+'<\/label>    <\/div>    <div class="col-md-0-5 no-padding">        <span class="btn-glyph-dynamic glyphicon glyphicon-trash" onclick="ModalConfirmation(MODAL_HEADER, MSG_CONFIRM_DELETE_SINGLE, &quot;objEmployeeListJS.RemoveDynamicFields(\'#AccountabilityAttachmentDynamicFields_'+i+"',objUpdateAccountabilityJS.DeleteAttachmentFunction(&#39;"+n.ServerFile+'&#39;))&quot;, &quot;function&quot;);"><\/span>    <\/div>     <div class="col-md-0-5 no-padding">         <span class="btn-glyph-dynamic glyphicon glyphicon-download-alt" onclick="objEMSCommonJS.DownloadAttachment(CheckFileIfExistsURL, \'WorkflowService_Accountability_Attachment_Path\',\''+n.ServerFile+"', '"+n.SourceFile+"')\"><\/span>     <\/div><\/div>");objEMSCommonJS.PopulateDropDown("#DivAccountabilityDownloadAttachmentDynamicFields #ddlType_"+i,AccountabilityAttachmentTypeDropDownOptions);$("#DivAccountabilityDownloadAttachmentDynamicFields #ddlType_"+t).val(n.AttachmentType);$("#DivAccountabilityDownloadAttachmentDynamicFields #txtRemarks_"+t).val(n.Remarks)};n.IsSuccess==!0&&($("#divAttachmentContainer").html(""),n.Result.length>0&&(t=1,$(n.Result).each(function(n,r){i(r,t);t++})))};objEMSCommonJS.GetAjax(GetAccountabilityAttachmentURL,n,"",t)},GetCommentSectionFormData:function(){var n=new FormData($("#frmAccountability").get(0));return n.append("CommentsForm.EmployeeAccountabilityID",$("#hdnEmployeeAccountabilityID").val()),n.append("CommentsForm.Comments",$("#txtAreaComments").val()),n},GetAttachmentSectionFormData:function(){$(".Accountability_Attachment_Type").each(function(n){$(this).prop("name","AttachmentForm.AddAttachmentForm["+n+"].AttachmentType")});$(".Accountability_Attachment_Remarks").each(function(n){$(this).prop("name","AttachmentForm.AddAttachmentForm["+n+"].Remarks")});$(".Accountability_Attachment_ServerFile").each(function(n){$(this).prop("name","AttachmentForm.AddAttachmentForm["+n+"].ServerFile")});$(".Accountability_Attachment_SourceFile").each(function(n){$(this).prop("name","AttachmentForm.AddAttachmentForm["+n+"].SourceFile")});$(".Accountability_Attachment_File").each(function(n){$(this).prop("name","AttachmentForm.AddAttachmentForm["+n+"].File")});var n=new FormData($("#frmAccountability").get(0));return n.append("AttachmentForm.EmployeeAccountabilityID",$("#hdnEmployeeAccountabilityID").val()),$(AccountabilityDeletedAttachments).each(function(t,i){n.append("AttachmentForm.DeleteAttachmentForm["+t+"].ServerFile",i.value)}),n},GetAttachmentTypeDropDownOptions:function(){var t=this,n;AccountabilityAttachmentTypeDropDownOptions=[];n=function(n){$(n.Result).each(function(n,t){AccountabilityAttachmentTypeDropDownOptions.push({Value:t.Value,Text:t.Description})})};objEMSCommonJS.GetAjax(AttachmentTypeDropDown,{},"",n)},RemoveDynamicFields:function(n,t){$(n).remove();ModalAlert(MODAL_HEADER,MSG_SUCCESS_DELETE_REC);t!=null&&t()},DeleteAttachmentFunction:function(n){AccountabilityDeletedAttachments.push(n)},AddAttachmentDynamicFields:function(){var i=this,t=$(".AccountabilityAttachmentDynamicFields:last").prop("id"),n=parseInt(t==undefined?0:t.replace("AccountabilityAttachmentDynamicFields_",""))+1;$("#DivAccountabilityUploadAttachmentDynamicFields").append('<div class="form-group form-fields AccountabilityAttachmentDynamicFields" id="AccountabilityAttachmentDynamicFields_'+n+'">    <div class="col-md-1-5 no-padding">        <select id="ddlType_'+n+'" class= "form-control required-field Accountability_Attachment_Type" title="Attachment Type"><\/select >    <\/div>    <div class="col-md-2-5 no-padding">        <textarea rows="3" cols="10" wrap="hard"  id="txtRemarks_'+n+'" maxlength="255" class="form-control Accountability_Attachment_Remarks" title="Remarks"><\/textarea>    <\/div>    <div class="col-md-3-5 no-padding">        <input type="file" id="fileAttachment_'+n+'" class="form-control required-field Accountability_Attachment_File" title="Attachment" accept=".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document">    <\/div>    <div class="col-md-3-5 no-padding">    <\/div>    <div class="col-md-0-5 no-padding">        <span class="btn-glyph-dynamic glyphicon glyphicon-trash" onclick="ModalConfirmation(MODAL_HEADER, MSG_CONFIRM_DELETE_SINGLE, &quot;objEmployeeListJS.RemoveDynamicFields(\'#AccountabilityAttachmentDynamicFields_'+n+"')&quot;, &quot;function&quot;);\"><\/span>    <\/div><\/div>");objEMSCommonJS.PopulateDropDown("#ddlType_"+n,AccountabilityAttachmentTypeDropDownOptions)}};objUpdateAccountabilityJS.Initialize()});
