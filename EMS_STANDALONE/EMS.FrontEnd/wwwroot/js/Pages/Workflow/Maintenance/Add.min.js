var objWorkflowAddJS,ResultTypeDropDownOptions=[];$(document).ready(function(){objWorkflowAddJS={Initialize:function(){var n=this;n.ElementBinding();$("#btnSave").show();$("#divWorkflowModal .form-control").attr("readonly",!1);$("#btnDelete #btnBack").remove();$("#DivApproverRoleDynamicFields").html("");$("#divWorkflowApprovalModal .modal-dialog").attr("style","width: 50%");n.GetResultTypeDropDownOptions()},AddSuccessFunction:function(){$("#btnSearch").click();$("#frmWorkflow").trigger("reset");$("#DivApproverRoleDynamicFields").html("");$("#DivWorkflowStepDynamicFields").html("");objWorkflowAddJS.AddWorkflowStepDynamicFields()},ElementBinding:function(){var n=this;Code($("#txtCode"));PreventSpace($("#txtCode"));$("#txtCode").bind("copy paste cut",function(n){n.preventDefault()});$("#divWorkflowBodyModal .close").click(function(){$("#DivApproverRoleDynamicFields").html("")});$("#btnAddWorkflowStepFields").click(function(){var r=$("#DivWorkflowStepDynamicFields .required-field"),t=!0,i=!0;r.each(function(){if($(this).val()=="")return $(this).focus(),t=!1,!1});$(".OrderDynamicFields").each(function(){var t=$(this).prop("id").replace("txtOrder_",""),r=n.ValidateApproverRole(t);if(r>0)return i=!1,!1});t&&($(".required-field").removeClass("errMessage"),i?($("#divWorkflowErrorMessage").html(""),n.AddWorkflowStepDynamicFields()):$("#divWorkflowErrorMessage").html('<label class="errMessage"><li>Approver'+SUFF_REQUIRED+"<\/li><\/label><br />"))});$("#btnSave").click(function(){objEMSCommonJS.ValidateBlankFields("#frmWorkflow","#divWorkflowErrorMessage",objWorkflowAddJS.ValidateDuplicateFields)&&ModalConfirmation(MODAL_HEADER,MSG_CONFIRM," objEMSCommonJS.PostAjax(true                         , WorkflowAddPostURL                         , objWorkflowAddJS.GetFormData()                         , '#divWorkflowErrorMessage'                         , '#btnSave'                         , objWorkflowAddJS.AddSuccessFunction); ","function")})},GetFormData:function(){var n=new FormData($("#frmWorkflow").get(0));return $(".OrderDynamicFields").each(function(t){$(this).val()!=""&&n.append("Workflow.WorkflowStepList["+t+"].Order",$(this).val())}),$(".StepCodeDynamicFields").each(function(t){var i,r;$(this).val()!=""&&(i=$(this).val(),n.append("Workflow.WorkflowStepList["+t+"].StepCode",i));r=$(this).prop("id").replace("txtStepCode_","");$(".RoleIDDynamicFields_"+r+" option").each(function(r){$(this).val()!=""&&(n.append("Workflow.WorkflowStepList["+t+"].WorkflowStepApproverList["+r+"].StepCode",i),n.append("Workflow.WorkflowStepList["+t+"].WorkflowStepApproverList["+r+"].RoleID",$(this).val()))})}),$(".StepDescriptionDynamicFields").each(function(t){$(this).val()!=""&&n.append("Workflow.WorkflowStepList["+t+"].StepDescription",$(this).val())}),$(".ResultTypeDynamicFields").each(function(t){$(this).val()!=""&&n.append("Workflow.WorkflowStepList["+t+"].ResultType",$(this).val())}),$(".IsRequiredDynamicFields").each(function(t){var i=$(this).is(":checked")?!0:!1;n.append("Workflow.WorkflowStepList["+t+"].IsRequired",i)}),$(".AllowBackflowDynamicFields").each(function(t){var i=$(this).is(":checked")?!0:!1;n.append("Workflow.WorkflowStepList["+t+"].AllowBackflow",i)}),$(".SendEmailToRequesterDynamicFields").each(function(t){var i=$(this).is(":checked")?!0:!1;n.append("Workflow.WorkflowStepList["+t+"].SendEmailToRequester",i)}),$(".SendEmailToApproverDynamicFields").each(function(t){var i=$(this).is(":checked")?!0:!1;n.append("Workflow.WorkflowStepList["+t+"].SendEmailToApprover",i)}),$(".TATDaysDynamicFields").each(function(t){$(this).val()!=""&&n.append("Workflow.WorkflowStepList["+t+"].TATDays",$(this).val())}),n},GetResultTypeDropDownOptions:function(){var n=this,t=function(t){$(t.Result).each(function(n,t){ResultTypeDropDownOptions.push({Value:t.Value,Text:t.Description})});n.AddWorkflowStepDynamicFields()};objEMSCommonJS.GetAjax(AddResultTypeDropDownURL,{},"",t)},PopulateDropDown:function(n,t){$(n).append($("<option/>",{value:"",text:"- Select an Item -"}));$(t).each(function(t,i){$(n).append($("<option/>",{value:i.Value,text:i.Text}))})},AddWorkflowStepDynamicFields:function(){var t=this,i=$(".WorkflowStepDynamicFields:last").prop("id"),n=parseInt(i==undefined?0:i.replace("WorkflowStepDynamicFields_",""))+1,r=n!=1?parseInt($("#txtOrder_"+(n-1)).val())+1:1;$("#DivWorkflowStepDynamicFields").append('<div class="form-group form-fields WorkflowStepDynamicFields" id="WorkflowStepDynamicFields_'+n+'">    <div class="col-md-0-75 no-padding">        <input id="txtOrder_'+n+'" value="'+r+'" class="form-control OrderDynamicFields required-field text-amount" maxlength="17" title="Order">    <\/div>    <div class="col-md-2 no-padding">        <input type="text" id="txtStepCode_'+n+'" class="form-control required-field StepCodeDynamicFields" title="Step Code" maxlength="50">    <\/div>    <div class="col-md-2-5 no-padding">        <input type="text" id="txtStepDescription_'+n+'" class="form-control required-field StepDescriptionDynamicFields" title="Step Description" maxlength="255">    <\/div>    <div class="col-md-1-5 no-padding">        <select id="ddlResultType_'+n+'" title="Result Type" class="form-control required-field ResultTypeDynamicFields"><\/select>    <\/div>    <div class="col-md-0-75 text-align-center no-padding">        <input type="checkbox" id="chkIsRequired_'+n+'" class="IsRequiredDynamicFields" title="IsRequired">    <\/div>    <div class="col-md-0-75 text-align-center no-padding">        <input type="checkbox" id="chkAllowBackflow_'+n+'" class="AllowBackflowDynamicFields" title="Allow Back Flow">    <\/div>    <div class="col-md-0-75 text-align-center no-padding">        <input type="checkbox" id="chkSendEmailToRequester_'+n+'" class="SendEmailToRequesterDynamicFields" title="Send Email to Requester">    <\/div>    <div class="col-md-0-75 text-align-center no-padding">        <input type="checkbox" id="chkSendEmailToApprover_'+n+'" class="SendEmailToApproverDynamicFields" title="Send Email to Approver">    <\/div>    <div class="col-md-0-75 no-padding">        <input type="text" id="txtTATDays_'+n+'" class="form-control text-amount required-field TATDaysDynamicFields" title="TAT Days">    <\/div>    <div class="col-md-0-75 text-align-center no-padding">        <label id="btnApprover_'+n+'">           <span class="btn-glyph-dynamic glyphicon glyphicon-list" title="Click to add approver role"><\/span>        <\/label>    <\/div>    <div class="col-md-0-5 text-align-center no-padding">        <span class="btn-glyph-dynamic glyphicon glyphicon-trash" onclick="ModalConfirmation(MODAL_HEADER, MSG_CONFIRM_DELETE_SINGLE, &quot;objWorkflowAddJS.RemoveDynamicFields(\'#WorkflowStepDynamicFields_'+n+"')&quot;, &quot;function&quot;);\"><\/span>    <\/div><\/div>");$("#btnApprover_"+n).click(function(){t.AddApproverRoleDynamicFields(n)});t.PopulateDropDown("#ddlResultType_"+n,ResultTypeDropDownOptions);NumberOnly($("#txtTATDays_"+n));NumberOnly($("#txtOrder_"+n))},AddApproverRoleDynamicFields:function(n){var t=$(".ApproverRoleDynamicFields:last").prop("id"),i=parseInt(t==undefined?0:t.replace("ApproverRoleDynamicFields_",""))+1;if(n==i){$("#DivApproverRoleDynamicFields").append('<div class="form-group form-fields ApproverRoleDynamicFields" id="ApproverRoleDynamicFields_'+n+'">   <div class="col-md-5">       <input type="text" id="" class="form-control listbox txtSearchBoxOne" placeholder="Search here..."/>       <select id="ddlListOne_'+n+'" class="form-control listbox" size="10"><\/select>   <\/div>   <div class="col-md-2 text-align-center listboxbutton">       <br/>       <br/>       <button type="button" id="btnMoveToListTwoAll_'+n+'" class="btnBlue formbtn btn-transfer">>><\/button>       <button type="button" id="btnMoveToListTwo_'+n+'" class="btnBlue formbtn btn-transfer">><\/button>       <button type="button" id="btnMoveToListOne_'+n+'" class="btnBlue formbtn btn-transfer"><<\/button>       <button type="button" id="btnMoveToListOneAll_'+n+'" class="btnBlue formbtn btn-transfer"><<<\/button>   <\/div>   <div class="col-md-5 RoleIDList">       <input type="text" id="" class="form-control listbox txtSearchBoxTwo" placeholder="Search here..."/>       <select id="ddlListTwo_'+n+'" class="form-control listbox required-field RoleIDDynamicFields_'+n+'" size="10"><\/select>   <\/div><\/div>');ListBoxGenerateValues(AddApproverRoleDropDownURL,{},"ddlListOne_"+n,"Value","Text");$("#btnMoveToListTwo_"+n).click(function(){ListBoxMove("ddlListOne_"+n,"ddlListTwo_"+n,!1,!0)});$("#btnMoveToListOne_"+n).click(function(){ListBoxMove("ddlListTwo_"+n,"ddlListOne_"+n,!1,!0)});$("#btnMoveToListTwoAll_"+n).click(function(){ListBoxMove("ddlListOne_"+n,"ddlListTwo_"+n,!0,!0)});$("#btnMoveToListOneAll_"+n).click(function(){ListBoxMove("ddlListTwo_"+n,"ddlListOne_"+n,!0,!0)});$(".txtSearchBoxOne").on("change keyup keydown",function(){ListBoxSearch("ddlListOne_"+n,$(this).val(),!1)});$(".txtSearchBoxTwo").on("change keyup keydown",function(){ListBoxSearch("ddlListTwo_"+n,$(this).val(),!1)});$("#divWorkflowApprovalHeaderModal .close").click(function(){$("#ApproverRoleDynamicFields_"+n).hide()})}$("#ApproverRoleDynamicFields_"+n).show();$("#divWorkflowApprovalModal").modal("show")},RemoveDynamicFields:function(n){var t=parseInt(n==undefined?0:n.replace("#WorkflowStepDynamicFields_",""));$(".WorkflowStepDynamicFields").each(function(){var n=$(this).prop("id").replace("WorkflowStepDynamicFields_","");t<n&&$("#txtOrder_"+n).val($("#txtOrder_"+n).val()-1)});$(n).remove();$("#divWorkflowApprovalModal #divWorkflowApprovalBodyModal #DivApproverRoleDynamicFields #ApproverRoleDynamicFields_"+t).remove();ModalAlert(MODAL_HEADER,MSG_SUCCESS_DELETE_REC)},ValidateApproverRole:function(n){var t=0,i=$("#ddlListTwo_"+n+" option").length;return i==0?(t++,$("#btnApprover_"+n).attr("style","color: #c40000")):$("#ddlListTwo_"+n+" option").each(function(){this.value==""?(t++,$("#btnApprover_"+n).attr("style","color: #c40000")):$("#btnApprover_"+n).attr("style","color: black")}),t},ValidateDuplicateFields:function(){var n=!0,t=0,i=0,r=[];return $(".OrderDynamicFields").each(function(){this.value!=""&&parseInt(this.value)>0&&r.push(this.value)}),$(".OrderDynamicFields").removeClass("errMessage"),$($.unique(r).sort()).each(function(n,t){parseInt(n)+1!=t&&i++}),$(".StepCodeDynamicFields").each(function(){var r,i,u;this.value!=""&&(r=this.value,i=$(this).prop("id").replace("txtStepCode_",""),$("#WorkflowStepDynamicFields_"+i+" #txtStepCode_"+i).removeClass("errMessage"),$("#WorkflowStepDynamicFields_"+i+" #txtStepDescription_"+i).removeClass("errMessage"),$("#WorkflowStepDynamicFields_"+i+" #ddlResultType_"+i).removeClass("errMessage"),$("#WorkflowStepDynamicFields_"+i+" #txtTATDays_"+i).removeClass("errMessage"),$(".StepCodeDynamicFields").not(this).filter(function(){this.value==r&&($("#WorkflowStepDynamicFields_"+i+" #txtStepCode_"+i).addClass("errMessage"),$("#WorkflowStepDynamicFields_"+i+" #txtStepDescription_"+i).addClass("errMessage"),$("#WorkflowStepDynamicFields_"+i+" #ddlResultType_"+i).addClass("errMessage"),$("#WorkflowStepDynamicFields_"+i+" #txtTATDays_"+i).addClass("errMessage"),t++)}),u=objWorkflowAddJS.ValidateApproverRole(i),u>0&&($("#divWorkflowErrorMessage").html('<label class="errMessage"><li>Approver'+SUFF_REQUIRED+"<\/li><\/label><br />"),n=!1))}),t>0&&($(".StepCodeDynamicFields").addClass("errMessage"),$("#divWorkflowErrorMessage").html('<label class="errMessage"><li>'+DUPLICATE_HIGHLIGHTED_FIELDS+"<\/li><\/label><br />"),n=!1),i>0&&($(".OrderDynamicFields").addClass("errMessage"),$("#divWorkflowErrorMessage").html('<label class="errMessage"><li>'+INCORRECT_ORDER_SEQUENCE+"<\/li><\/label><br />"),n=!1),n||$("html, body").animate({scrollTop:0},"slow"),n}};objWorkflowAddJS.Initialize()});
