var objFormJS,SystemRoleDropDownOptions;const UserNameAutoCompleteURL="/ManPower/Signatories?handler=UserNameAutoComplete",SystemRoleDropDown="/ManPower/Signatories?handler=SystemRoleDropDown",GetPositionLevelDropDownURL="/ManPower/Signatories?handler=PositionLevelDropDown",GetPositionDropDownURL="/ManPower/Signatories?handler=PositionDropDown",CommonPositionDropdownURL="/ManPower/Signatories?handler=PositionDropdown",CommonApproversListURL="/ManPower/Signatories?handler=Signatories",SignatoriesPostURL="/ManPower/Signatories?handler=Submit";SystemRoleDropDownOptions=[];$(document).ready(function(){objFormJS={Initialize:function(){var n=this;GenerateDropdownValues(GetPositionLevelDropDownURL,"ddlPositionLevel","Value","Text","","",!1);n.GetSystemRoleDropDownOptions();n.ElementBinding()},ElementBinding:function(){var n=this;$("#txtRequesterUserName").autocomplete({source:function(n,t){$.ajax({url:UserNameAutoCompleteURL,type:"GET",dataType:"json",data:{Term:$("#txtRequesterUserName").val(),TopResults:20},success:function(n){n.IsSuccess?t($.map(n.Result,function(n){return{label:n.Description,value:n.ID}})):ModalAlert(MODAL_HEADER,n.Result)},error:function(n){ModalAlert(MODAL_HEADER,n.responseText)}})},select:function(n,t){return t.item.label!=null,!1},change:function(n,t){t.item==null?($("#hdnRequesterID").val(0),$(this).val("")):($("#hdnRequesterID").val(t.item.value),$(this).val(t.item.label),$("#ddlPosition").val()!=""&&objFormJS.LoadApprovers())},focus:function(n,t){$(this).val(t.item.label);n.preventDefault()}});$("#ddlPositionLevel").change(function(){GenerateDropdownValues(GetPositionDropDownURL+"&PositionLevelID="+$("#ddlPositionLevel").val(),"ddlPosition","Value","Text","","",!1)});$("#ddlPosition").change(function(){$("#ddlPosition").val()==""||$("#hdnRequesterID").val()!=0&&objFormJS.LoadApprovers()});$("#btnAddApproversFields").click(function(){var i=$("#DivApproverDynamicFields .required-field"),t=!0;i.each(function(){if($(this).val()=="")return $(this).focus(),t=!1,!1});t&&n.AddApproverDynamicFields()});$("#btnSave").click(function(){objEMSCommonJS.ValidateBlankFields("#frmMRFSignatories","#divMRFSignatoriesErrorMessage",objFormJS.ValidateDuplicateFields)&&($(".Signatories_IDDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].ID")}),$(".Signatories_WorkflowIDDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].WorkflowID")}),$(".Signatories_WorkflowStepIDDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].WorkflowStepID")}),$(".Signatories_WorkflowStepCodeDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].WorkflowStepCode")}),$(".Signatories_WorkflowStepApproverIDDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].WorkflowStepApproverID")}),$(".Signatories_RequesterIDDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].RequesterID")}),$(".Signatories_ApproverRoleIDDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].SystemRole.ID")}),$(".Signatories_ApproverRoleNameDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].SystemRole.RoleName")}),$(".Signatories_PositionIDDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].PositionID")}),$(".Signatories_Position_IDDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].Position.ID")}),$(".Signatories_Position_CodeDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].Position.Code")}),$(".Signatories_Position_TitleDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].Position.Title")}),$(".Signatories_Position_PositionLevelIDDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].Position.PositionLevelID")}),$(".Signatories_PositionLevel_IDDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].PositionLevel.ID")}),$(".Signatories_PositionLevel_DescriptionDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].PositionLevel.Description")}),$(".Signatories_ApproverRoleDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].ApproverRoleID")}),$(".Signatories_ApproverDescriptionDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].ApproverDescription")}),$(".Signatories_TATDaysDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].TATDays")}),$(".Signatories_OrderDynamicFields").each(function(n){$(this).prop("name","MRFSignatory["+n+"].Order")}),ModalConfirmation(MODAL_HEADER,MSG_CONFIRM,"objEMSCommonJS.PostAjax(true                         , SignatoriesPostURL                         , new FormData($('#frmMRFSignatories').get(0))                         , '#divMRFSignatoriesErrorMessage'                         , '#btnSave'                         , objFormJS.SaveSuccessFunction);","function"))})},GetSystemRoleDropDownOptions:function(){var n=this,t=function(t){$(t.Result).each(function(n,t){SystemRoleDropDownOptions.push({Value:t.Value,Text:t.Text})});n.AddApproverDynamicFields()};objEMSCommonJS.GetAjax(SystemRoleDropDown,{},"",t)},SaveSuccessFunction:function(){objFormJS.LoadApprovers()},AddApproverDynamicFields:function(){var r=this,t=$(".ApproverDynamicFields:last").prop("id"),n=parseInt(t==undefined?0:t.replace("ApproverDynamicFields_",""))+1,i=n!=1?parseInt($("#txtOrder_"+(n-1)).val())+1:1;$("#DivApproverDynamicFields").append('<div class="form-group form-fields ApproverDynamicFields" id="ApproverDynamicFields_'+n+'">    <div class="col-md-3 no-padding">        <input type="hidden" id="hdnID_'+n+'" value="'+$("#hdnID").val()+'" class="Signatories_IDDynamicFields">        <input type="hidden" id="hdnWorkflowID_'+n+'" value="'+$("#hdnWorkflowID").val()+'" class="Signatories_WorkflowIDDynamicFields">        <input type="hidden" id="hdnRequesterID_'+n+'" value="'+$("#hdnRequesterID").val()+'" class="Signatories_RequesterIDDynamicFields">        <input type="hidden" id="hdnPositionID_'+n+'" value="'+$("#ddlPosition").val()+'" class="Signatories_PositionIDDynamicFields">        <input type="hidden" id="hdnWorkflowStepID_'+n+'" class="Signatories_WorkflowStepIDDynamicFields">        <input type="hidden" id="hdnWorkflowStepCode_'+n+'" class="Signatories_WorkflowStepCodeDynamicFields">        <input type="hidden" id="hdnWorkflowStepApproverID_'+n+'" class="Signatories_WorkflowStepApproverIDDynamicFields">        <select id="ddlApproverRole_'+n+'" class= "form-control required-field Signatories_ApproverRoleDynamicFields" title="Approver Role"><\/select >    <\/div>    <div class="col-md-4 no-padding">        <input id="txtApproverDescription_'+n+'" maxlength="255" class="form-control required-field Signatories_ApproverDescriptionDynamicFields" title="Approver Description">    <\/div>    <div class="col-md-2 no-padding">        <input id="txtTATDays_'+n+'" maxlength="15" class="form-control required-field Signatories_TATDaysDynamicFields" title="TAT Days">    <\/div>    <div class="col-md-1 no-padding">        <input id="txtOrder_'+n+'" value="'+i+'" class="form-control Signatories_OrderDynamicFields text-amount" maxlength="17" title="Order" readonly>    <\/div>    <div class="col-md-0-5 no-padding">        <span class="btn-glyph-dynamic glyphicon glyphicon-trash" onclick="ModalConfirmation(MODAL_HEADER, MSG_CONFIRM_DELETE_SINGLE, &quot;objFormJS.RemoveDynamicFields(\'#ApproverDynamicFields_'+n+"')&quot;, &quot;function&quot;);\"><\/span>    <\/div><\/div>");objEMSCommonJS.PopulateDropDown("#ddlApproverRole_"+n,SystemRoleDropDownOptions);$("#ddlApproverRole_"+n).change(function(){$("#hdnRoleID_"+n).val($("#ddlApproverRole_"+n).val());$("#hdnRoleName_"+n).val($("#ddlApproverRole_"+n+" option:selected").text())});NumberOnly($("#txtTATDays_"+n))},RemoveDynamicFields:function(n){var t=parseInt(n==undefined?0:n.replace("#ApproverDynamicFields_",""));$(".ApproverDynamicFields").each(function(){var n=$(this).prop("id").replace("ApproverDynamicFields_","");t<n&&$("#txtOrder_"+n).val($("#txtOrder_"+n).val()-1)});$(n).remove();ModalAlert(MODAL_HEADER,MSG_SUCCESS_DELETE_REC)},ValidateDuplicateFields:function(){var n=!0,t=0;return $(".Signatories_ApproverRoleDynamicFields").each(function(){if(this.value!=""){var i=this.value,n=$(this).prop("id").replace("ddlApproverRole_","");$("#ApproverDynamicFields_"+n+" input").removeClass("errMessage");$("#ApproverDynamicFields_"+n+" select").removeClass("errMessage");$(".Signatories_ApproverRoleDynamicFields").not(this).filter(function(){this.value==i&&($("#ApproverDynamicFields_"+n+" input").addClass("errMessage"),$("#ApproverDynamicFields_"+n+" select").addClass("errMessage"),t++)})}}),t>0&&($("#divMRFSignatoriesErrorMessage").html('<label class="errMessage"><li>'+DUPLICATE_HIGHLIGHTED_FIELDS+"<\/li><\/label><br />"),n=!1),n||$("html, body").animate({scrollTop:0},"slow"),n},LoadApprovers:function(){var n,t,i;Loading(!0);n=this;$("#DivApproverDynamicFields").html("");t={UserID:$("#hdnRequesterID").val(),PositionID:$("#ddlPosition").val()};i=function(t){var i=1,r=function(t,i){n.AddApproverDynamicFields();i==1&&($("#hdnID").val(t.ID),$("#hdnWorkflowID").val(t.WorkflowID));$("#hdnWorkflowStepID_"+i).val(t.WorkflowStepID);$("#hdnWorkflowStepCode_"+i).val(t.WorkflowStepCode);$("#hdnWorkflowStepApproverID_"+i).val(t.WorkflowStepApproverID);$("#ddlApproverRole_"+i).val(t.ApproverRoleID);$("#txtApproverDescription_"+i).val(t.ApproverDescription);$("#txtTATDays_"+i).val(t.TATDays);$("#txtOrder_"+i).val(t.Order)};t.Result.length>0?$(t.Result).each(function(n,t){r(t,i);i++}):n.AddApproverDynamicFields()};objEMSCommonJS.GetAjax(CommonApproversListURL,t,"",i)}};objFormJS.Initialize()});
